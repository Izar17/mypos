import{h as At}from"./tax-8FHrRWQm.js";import{b as Tt,a as u}from"./bootstrap-B2JubnBk.js";import{c as Et,e as kt}from"./components-CfbAjZ7-.js";import{_ as c,n as Dt}from"./currency-gBUix5n2.js";import{j as Rt}from"./join-array-DLflg2fd.js";import{b as Nt}from"./ns-prompt-popup-Uu9Ikkt9.js";import{_ as Ot}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as Pt,o as i,c as d,b as t,e as Vt,t as s,n as jt,f as Lt,F as Bt,g as It}from"./runtime-core.esm-bundler-K4i56aP4.js";import"./chart-D2s_fKm5.js";import"./ns-alert-popup-BZCPp3F-.js";import"./ns-avatar-image-szFVNiiS.js";import"./index.es-CuHZTwqh.js";const Mt={name:"ns-xreading-report",data(){return{saleReport:"",startDateField:{name:"start_date",type:"datetime",value:ns.date.moment.startOf("day").format()},result:{},isLoading:!1,users:[],ns:window.ns,selectedUser:"",filterUser:{label:c("Filter User"),name:"filterUser",type:"select",value:"",options:[],description:c("Allow you to choose the report type.")},field:{type:"datetimepicker",value:"2021-02-07",name:"date"}}},components:{nsDatepicker:Et,nsDateTimePicker:kt},computed:{},methods:{__:c,nsCurrency:Dt,joinArray:Rt,printSaleReport(){this.$htmlToPaper("sale-report")},async openUserFiltering(){try{this.isLoading=!0;const l=await new Promise((o,a)=>{Tt.get("/api/users").subscribe({next:r=>{this.users=r,this.isLoading=!1,this.filterUser.options=[{label:c("All Users"),value:""},...this.users.map(e=>({label:e.username,value:e.id}))],Popup.show(Nt,{...this.filterUser,resolve:o,reject:a})},error:r=>{this.isLoading=!1,u.error(c("No user was found for proceeding the filtering.")),a(r)}})}),_=this.users.filter(o=>o.id===l);if(_.length>0){let o=_[0];this.selectedUser=`${o.username} ${o.first_name||o.last_name?o.first_name+" "+o.last_name:""}`,this.filterUser.value=l,this.result=[],this.loadReport()}}catch(l){console.log({exception:l})}},loadReport(){if(this.startDate===null)return u.error(c("Unable to proceed. Select a correct time range.")).subscribe();At(this.startDate),this.isLoading=!0,Tt.post("/api/reports/xzreading-report",{startDate:this.startDateField.value,user_id:this.filterUser.value}).subscribe({next:l=>{this.isLoading=!1,this.result=l.result,console.log(this.result)},error:l=>{this.isLoading=!1,u.error(l.message).subscribe()}})}},props:["storeLogo","storeName"],mounted(){}},zt={id:"report-section",class:"px-4"},Gt={class:"flex -mx-2"},Ht={class:"px-2"},Wt={class:"px-2"},Xt=t("i",{class:"las la-filter text-xl"},null,-1),Zt={class:"pl-2"},qt={class:"px-2"},Jt={class:"pl-2"},Kt={class:"px-2"},Qt=t("i",{class:"las la-print text-xl"},null,-1),Yt={class:"pl-2"},$t={key:0,class:"w-full h-full pt-5"},ts={class:"w-full md:w-1/2 lg:w-1/3 shadow-lg bg-white p-2 mx-auto"},ss={class:"flex items-center justify-center"},es={class:"text-sm font-bold"},rs={class:"flex items-center justify-center"},ls={class:"text-sm font-bold"},os={class:"flex items-center justify-center"},_s={class:"text-sm font-bold"},cs=t("div",{class:"p-2"},[t("div",{class:"flex flex-wrap -mx-2 text-xs"})],-1),is=["set"],ds={class:"w-full"},as={key:0},us={class:"text-xs"},hs=t("tr",{class:"border-b"},null,-1),ps={class:"text-xs"},ms={class:""},xs={class:"text-right"},gs={class:"text-right"},fs={class:""},bs={class:"text-right"},ys={class:"text-right"},vs={class:""},Cs={class:"text-right"},Ss={class:"text-right"},ws=t("tr",{class:"border-b"},null,-1),Fs={class:""},Ts={class:"text-right"},Ls={class:"text-right"},Us={class:""},As=t("td",null,null,-1),Es={class:"text-right"},ks={class:""},Ds=t("td",null,null,-1),Rs={class:"text-right"},Ns={class:""},Os=t("td",null,null,-1),Ps={class:"text-right"},Vs={class:""},js=t("td",null,null,-1),Bs={class:"text-right"},Is={class:""},Ms=t("td",null,null,-1),zs={class:"text-right"},Gs={class:""},Hs=t("td",null,null,-1),Ws=t("td",{class:"text-right"},"0",-1),Xs=t("tr",{class:"border-b"},null,-1),Zs={class:""},qs=t("td",null,null,-1),Js={class:"text-right"},Ks={class:""},Qs={class:"pl-3"},Ys={class:"text-right"},$s={class:"text-right"},te={class:"pl-3"},se={class:"text-right"},ee={class:"text-right"},re={class:""},le=t("td",{class:"text-right"},null,-1),oe={class:"pl-3"},_e={class:"text-right"},ne={class:"text-right"},ce={class:""},ie=t("td",{class:"text-right"},null,-1),de={class:"pl-3"},ae={class:"text-right"},ue={class:"text-right"},he={class:"pl-3"},pe={class:"text-right"},me={class:"text-right"},xe={class:"pl-3"},ge={class:"text-right"},fe={class:"text-right"},be={class:"pl-3"},ye={class:"text-right"},ve={class:"text-right"},Ce={class:"pl-3"},Se={class:"text-right"},we={class:"text-right"},Fe=t("tr",{class:"border-b"},null,-1),Te={colspan:"3",class:"text-center"};function Le(l,_,o,a,r,e){var h,p,m,x,g,f,b,y,v,C,S,w,F,T,L,U,A,E,k,D,R,N,O,P,V,j,B,I,M,z,G,H,W,X,Z,q,J,K,Q,Y,$,tt,st,et,rt,lt,ot,_t,nt,ct,it,dt,at,ut,ht,pt,mt,xt,gt,ft,bt,yt,vt,Ct,St,wt,Ft;const Ut=Pt("ns-date-time-picker");return i(),d("div",zt,[t("div",Gt,[t("div",Ht,[Vt(Ut,{field:r.startDateField},null,8,["field"])]),t("div",Wt,[t("button",{onClick:_[0]||(_[0]=n=>e.openUserFiltering()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[Xt,t("span",Zt,s(e.__("By User"))+" : "+s(r.selectedUser||e.__("All Users")),1)])]),t("div",qt,[t("button",{onClick:_[1]||(_[1]=n=>e.loadReport()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[t("i",{class:jt([r.isLoading?"animate-spin":"","las la-sync-alt text-xl"])},null,2),t("span",Jt,s(e.__("Load")),1)])]),t("div",Kt,[t("button",{onClick:_[2]||(_[2]=n=>e.printSaleReport()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[Qt,t("span",Yt,s(e.__("Print")),1)])])]),t("div",null,[r.result.store_name?(i(),d("div",$t,[t("div",ts,[t("div",ss,[t("p",es,s(r.result.store_name),1)]),t("div",rs,[t("p",ls,s(r.result.title),1)]),t("div",os,[t("p",_s,s(r.result.date),1)]),cs,t("div",{class:"table w-full text-xs",set:l.vat_12=parseFloat((p=(h=r.result)==null?void 0:h.orders)==null?void 0:p.vatable)+parseFloat((x=(m=r.result)==null?void 0:m.orders)==null?void 0:x.sc_vatable)-(parseFloat((f=(g=r.result)==null?void 0:g.orders)==null?void 0:f.vatable)+parseFloat((y=(b=r.result)==null?void 0:b.orders)==null?void 0:y.sc_vatable))/1.12},[t("table",ds,[r.result.cashier?(i(),d("tr",as,[t("td",us,s(e.__("Cashier Name:"))+" "+s((v=r.result)==null?void 0:v.cashier),1)])):Lt("",!0),hs,t("tbody",ps,[t("tr",null,[t("td",ms,s(e.__("TOTAL SALES")),1),t("td",xs,s((S=(C=r.result)==null?void 0:C.orders)==null?void 0:S.total_sales_count),1),t("td",gs,s(e.nsCurrency((F=(w=r.result)==null?void 0:w.orders)==null?void 0:F.total_sales)),1)]),t("tr",null,[t("td",fs,s(e.__("LESS TOTAL REFUND")),1),t("td",bs,s((L=(T=r.result)==null?void 0:T.orders)==null?void 0:L.total_refunds_count),1),t("td",ys,s(e.nsCurrency((A=(U=r.result)==null?void 0:U.orders)==null?void 0:A.total_refunds)),1)]),t("tr",null,[t("td",vs,s(e.__("LESS TOTAL DISCOUNT")),1),t("td",Cs,s((k=(E=r.result)==null?void 0:E.orders)==null?void 0:k.total_disc_count),1),t("td",Ss,s(e.nsCurrency((R=(D=r.result)==null?void 0:D.orders)==null?void 0:R.total_disc)),1)]),ws,t("tr",null,[t("td",Fs,s(e.__("SUBTOTAL")),1),t("td",Ts,s((O=(N=r.result)==null?void 0:N.orders)==null?void 0:O.total_sales_count),1),t("td",Ls,s(e.nsCurrency((V=(P=r.result)==null?void 0:P.orders)==null?void 0:V.subtotal)),1)]),t("tr",null,[t("td",Us,s(e.__("SERVICE CHARGE")),1),As,t("td",Es,s(e.nsCurrency((B=(j=r.result)==null?void 0:j.orders)==null?void 0:B.service_charge)),1)]),t("tr",null,[t("td",ks,s(e.__("LESS 12% VAT")),1),Ds,t("td",Rs,s(e.nsCurrency(l.vat_12||0)),1)]),t("tr",null,[t("td",Ns,s(e.__("NET SALES")),1),Os,t("td",Ps,s(e.nsCurrency(parseFloat(((M=(I=r.result)==null?void 0:I.orders)==null?void 0:M.total)-l.vat_12)||0)),1)]),t("tr",null,[t("td",Vs,s(e.__("VATable Sales")),1),js,t("td",Bs,s(e.nsCurrency(parseFloat((G=(z=r.result)==null?void 0:z.orders)==null?void 0:G.vatable)+parseFloat((W=(H=r.result)==null?void 0:H.orders)==null?void 0:W.sc_vatable)||0)),1)]),t("tr",null,[t("td",Is,s(e.__("VAT-Exempt Sales")),1),Ms,t("td",zs,s(e.nsCurrency(parseFloat((Z=(X=r.result)==null?void 0:X.orders)==null?void 0:Z.vat_exempt)||0)),1)]),t("tr",null,[t("td",Gs,s(e.__("VAT Zero-Rated Sales")),1),Hs,Ws]),Xs,t("tr",null,[t("td",Zs,s(e.__("TERMINAL TOTAL")),1),qs,t("td",Js,s(e.nsCurrency(parseFloat((J=(q=r.result)==null?void 0:q.orders)==null?void 0:J.total)||0)),1)]),t("tr",null,[t("td",Ks,s(e.__("TRANSACTIONS")),1)]),t("tr",null,[t("td",Qs,s(e.__("Dine In")),1),t("td",Ys,s((Q=(K=r.result)==null?void 0:K.orders)==null?void 0:Q.dinein_count),1),t("td",$s,s(e.nsCurrency(parseFloat(($=(Y=r.result)==null?void 0:Y.orders)==null?void 0:$.dinein_total)||0)),1)]),t("tr",null,[t("td",te,s(e.__("Take Away")),1),t("td",se,s((st=(tt=r.result)==null?void 0:tt.orders)==null?void 0:st.takeaway_count),1),t("td",ee,s(e.nsCurrency(parseFloat((rt=(et=r.result)==null?void 0:et.orders)==null?void 0:rt.takeaway_total)||0)),1)]),t("tr",null,[t("td",re,s(e.__("TENDERS")),1),le]),(i(!0),d(Bt,null,It((lt=r.result)==null?void 0:lt.payments,n=>(i(),d("tr",null,[t("td",oe,s(n.label),1),t("td",_e,s(n.count),1),t("td",ne,s(e.nsCurrency(parseFloat(n.total))),1)]))),256)),t("tr",null,[t("td",ce,s(e.__("DISCOUNTS")),1),ie]),t("tr",null,[t("td",de,s(e.__("SC")),1),t("td",ae,s((_t=(ot=r.result)==null?void 0:ot.orders)==null?void 0:_t.sc_count_disc),1),t("td",ue,s(e.nsCurrency(parseFloat((ct=(nt=r.result)==null?void 0:nt.orders)==null?void 0:ct.sc_total_disc)||0)),1)]),t("tr",null,[t("td",he,s(e.__("PWD")),1),t("td",pe,s((dt=(it=r.result)==null?void 0:it.orders)==null?void 0:dt.pwd_count_disc),1),t("td",me,s(e.nsCurrency(parseFloat((ut=(at=r.result)==null?void 0:at.orders)==null?void 0:ut.pwd_total_disc)||0)),1)]),t("tr",null,[t("td",xe,s(e.__("EMP10")),1),t("td",ge,s((pt=(ht=r.result)==null?void 0:ht.orders)==null?void 0:pt.emp10_count_disc),1),t("td",fe,s(e.nsCurrency(parseFloat((xt=(mt=r.result)==null?void 0:mt.orders)==null?void 0:xt.emp10_total_disc)||0)),1)]),t("tr",null,[t("td",be,s(e.__("EMP15")),1),t("td",ye,s((ft=(gt=r.result)==null?void 0:gt.orders)==null?void 0:ft.emp15_count_disc),1),t("td",ve,s(e.nsCurrency(parseFloat((yt=(bt=r.result)==null?void 0:bt.orders)==null?void 0:yt.emp15_total_disc)||0)),1)]),t("tr",null,[t("td",Ce,s(e.__("REG")),1),t("td",Se,s((Ct=(vt=r.result)==null?void 0:vt.orders)==null?void 0:Ct.reg_count_disc),1),t("td",we,s(e.nsCurrency(parseFloat((wt=(St=r.result)==null?void 0:St.orders)==null?void 0:wt.reg_total_disc)||0)),1)]),Fe,t("tr",null,[t("td",Te,s((Ft=r.result)==null?void 0:Ft.generated_date),1)])])])],8,is)])])):Lt("",!0)])])}const Ie=Ot(Mt,[["render",Le]]);export{Ie as default};

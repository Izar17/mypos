import{d as P,n as C,p as k,v as T,w as F,b as j,P as V}from"./bootstrap-Cq4cdc46.js";import{n as S}from"./ns-prompt-popup-ncfXAYOx.js";import{_ as a,n as L}from"./currency-Dtag6qPd.js";import{_ as g}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as v,o as l,c as d,a as e,j as h,t as r,e as y,b as m,F as O,f as w,h as b,w as A}from"./runtime-core.esm-bundler-fVX7Ok1h.js";import"./chart-CwFtjAqO.js";const N={data(){return{products:[],isLoading:!1}},props:["popup"],computed:{order(){return this.popup.params.order}},mounted(){this.loadProducts()},methods:{__:a,nsCurrency:L,close(){this.popup.params.reject(!1),this.popup.close()},loadProducts(){this.isLoading=!0;const s=this.popup.params.order.id;P.get(`/api/orders/${s}/products`).subscribe(t=>{this.isLoading=!1,this.products=t})},openOrder(){this.popup.close(),this.popup.params.resolve(this.order)}}},B={class:"shadow-lg ns-box w-6/7-screen md:w-3/5-screen lg:w-2/5-screen h-6/7-screen flex flex-col overflow-hidden"},D={class:"p-2 flex justify-between text-primary items-center border-b ns-box-header"},H={class:"font-semibold"},U={key:0},q={class:"flex-auto p-2 overflow-y-auto ns-box-body"},K={key:0,class:"flex-auto relative"},E={class:"h-full w-full flex items-center justify-center"},M={class:"flex-col border-b border-info-primary py-2"},R={class:"title font-semibold text-primary flex justify-between"},Y={class:"text-sm text-primary"},z={class:"flex justify-end p-2 border-t ns-box-footer"},G={class:"px-1"},I={class:"-mx-2 flex"},J={class:"px-1"},Q={class:"px-1"};function W(s,t,i,x,c,o){const n=v("ns-close-button"),p=v("ns-spinner"),f=v("ns-button");return l(),d("div",B,[e("div",D,[e("h3",H,[h(r(o.__("Products"))+" â€” "+r(o.order.code)+" ",1),o.order.title?(l(),d("span",U,"("+r(o.order.title)+")",1)):y("",!0)]),e("div",null,[m(n,{onClick:t[0]||(t[0]=_=>o.close())})])]),e("div",q,[c.isLoading?(l(),d("div",K,[e("div",E,[m(p)])])):y("",!0),c.isLoading?y("",!0):(l(!0),d(O,{key:1},w(c.products,_=>(l(),d("div",{class:"item",key:_.id},[e("div",M,[e("div",R,[e("span",null,r(_.name)+" (x"+r(_.quantity)+")",1),e("span",null,r(o.nsCurrency(s.price)),1)]),e("div",Y,[e("ul",null,[e("li",null,r(o.__("Unit"))+" : "+r(_.unit.name),1)])])])]))),128))]),e("div",z,[e("div",G,[e("div",I,[e("div",J,[m(f,{onClick:t[1]||(t[1]=_=>o.openOrder()),type:"info"},{default:b(()=>[h(r(o.__("Open")),1)]),_:1})]),e("div",Q,[m(f,{onClick:t[2]||(t[2]=_=>o.close()),type:"error"},{default:b(()=>[h(r(o.__("Close")),1)]),_:1})])])])])])}const X=g(N,[["render",W]]),Z={props:["orders"],data(){return{searchField:"",columns:{rightColumn:[],leftColumn:[]}}},watch:{orders(){this.$nextTick(()=>{C.doAction("ns-pos-pending-orders-refreshed",this.orders.map(s=>({order:s,dom:document.querySelector(`[data-order-id="${s.id}"]`)})))})}},mounted(){this.columns.leftColumn=C.applyFilters("ns-pending-orders-left-column",[{label:a("Code"),value:s=>s.code},{label:a("Cashier"),value:s=>s.user_username},{label:a("Total"),value:s=>s.total},{label:a("Tendered"),value:s=>s.tendered}]),this.columns.rightColumn=C.applyFilters("ns-pending-orders-right-column",[{label:a("Customer"),value:s=>`${s.customer_first_name} ${s.customer_last_name}`},{label:a("Date"),value:s=>s.created_at},{label:a("Type"),value:s=>s.type}]),this.popupCloser()},name:"ns-pos-pending-order",methods:{__:a,popupCloser:k,previewOrder(s){this.$emit("previewOrder",s)},proceedOpenOrder(s){this.$emit("proceedOpenOrder",s)},searchOrder(){this.$emit("searchOrder",this.searchField)},printOrder(s){this.$emit("printOrder",s)}}},ee={class:"flex flex-auto flex-col overflow-hidden"},se={class:"p-1"},te={class:"flex rounded border-2 input-group info"},oe=e("i",{class:"las la-search"},null,-1),re={class:"mr-1 hidden md:visible"},ne={class:"overflow-y-auto flex flex-auto"},le={class:"flex p-2 flex-auto flex-col overflow-y-auto"},de=["data-order-id"],ie={class:"text-primary"},ae={class:"px-2"},ce={class:"flex flex-wrap -mx-4"},pe={class:"w-full md:w-1/2 px-2"},ue={class:"w-full md:w-1/2 px-2"},_e={class:"flex justify-end w-full mt-2"},he={class:"flex rounded-lg overflow-hidden ns-buttons"},me=["onClick"],fe=e("i",{class:"las la-lock-open"},null,-1),ve=["onClick"],xe=e("i",{class:"las la-eye"},null,-1),be=["onClick"],ye=e("i",{class:"las la-print"},null,-1),Oe={key:0,class:"h-full v-full items-center justify-center flex"},we={class:"text-semibold text-primary"};function ge(s,t,i,x,c,o){return l(),d("div",ee,[e("div",se,[e("div",te,[A(e("input",{onKeyup:t[0]||(t[0]=F(n=>o.searchOrder(),["enter"])),"onUpdate:modelValue":t[1]||(t[1]=n=>c.searchField=n),type:"text",class:"p-2 outline-none flex-auto"},null,544),[[T,c.searchField]]),e("button",{onClick:t[2]||(t[2]=n=>o.searchOrder()),class:"w-16 md:w-24"},[oe,e("span",re,r(o.__("Search")),1)])])]),e("div",ne,[e("div",le,[(l(!0),d(O,null,w(i.orders,n=>(l(),d("div",{"data-order-id":n.id,class:"border-b ns-box-body w-full py-2 ns-order-line",key:n.id},[e("h3",ie,r(n.table_name||"Untitled Order"),1),e("div",ae,[e("div",ce,[e("div",pe,[(l(!0),d(O,null,w(c.columns.leftColumn,(p,f)=>(l(),d("p",{key:f,class:"text-sm text-primary"},[e("strong",null,r(p.label),1),h(" : "+r(p.value(n)),1)]))),128))]),e("div",ue,[(l(!0),d(O,null,w(c.columns.rightColumn,(p,f)=>(l(),d("p",{key:f,class:"text-sm text-primary"},[e("strong",null,r(p.label),1),h(" : "+r(p.value(n)),1)]))),128))])])]),e("div",_e,[e("div",he,[e("button",{onClick:p=>o.proceedOpenOrder(n),class:"info outline-none px-2 py-1"},[fe,h(" "+r(o.__("Open")),1)],8,me),e("button",{onClick:p=>o.previewOrder(n),class:"success outline-none px-2 py-1"},[xe,h(" "+r(o.__("Products")),1)],8,ve),e("button",{onClick:p=>o.printOrder(n),class:"warning outline-none px-2 py-1"},[ye,h(" "+r(o.__("Print")),1)],8,be)])])],8,de))),128)),i.orders.length===0?(l(),d("div",Oe,[e("h3",we,r(o.__("Nothing to display...")),1)])):y("",!0)])])])}const Ce=g(Z,[["render",ge]]),Pe={props:["popup"],components:{nsPosPendingOrders:Ce},methods:{__:a,popupResolver:j,popupCloser:k,searchOrder(s){P.get(`/api/crud/${this.active}?search=${s}`).subscribe(t=>{this.orders=t.data})},setActiveTab(s){this.active=s,this.loadOrderFromType(s)},openOrder(s){POS.loadOrder(s.id),this.popup.close()},loadOrderFromType(s){P.get(`/api/crud/${s}`).subscribe(t=>{this.orders=t.data})},previewOrder(s){new Promise((i,x)=>{Popup.show(X,{order:s,resolve:i,reject:x})}).then(i=>{this.proceedOpenOrder(s)},i=>i)},printOrder(s){POS.print.process(s.id,"sale")},proceedOpenOrder(s){if(POS.products.getValue().length>0)return Popup.show(S,{title:a("Confirm Your Action"),message:a("The cart is not empty. Opening an order will clear your cart would you proceed ?"),onAction:i=>{i&&this.openOrder(s)}});this.openOrder(s)}},data(){return{active:"ns.hold-orders",searchField:"",orders:[]}},mounted(){this.loadOrderFromType(this.active),this.popupCloser()}},ke={class:"shadow-lg ns-box w-6/7-screen md:w-3/5-screen lg:w-2/5-screen h-6/7-screen flex flex-col overflow-hidden"},$e={class:"p-2 flex justify-between text-primary items-center ns-box-header border-b"},Te={class:"font-semibold"},Fe={class:"p-2 flex overflow-hidden flex-auto ns-box-body"},je={class:"p-2 flex justify-between ns-box-footer border-t"},Ve=e("div",null,null,-1);function Se(s,t,i,x,c,o){const n=v("ns-close-button"),p=v("ns-pos-pending-orders"),f=v("ns-tabs-item"),_=v("ns-tabs"),$=v("ns-button");return l(),d("div",ke,[e("div",$e,[e("h3",Te,r(o.__("Orders")),1),e("div",null,[m(n,{onClick:t[0]||(t[0]=u=>i.popup.close())})])]),e("div",Fe,[m(_,{active:c.active,onChangeTab:t[5]||(t[5]=u=>o.setActiveTab(u))},{default:b(()=>[m(f,{identifier:"ns.hold-orders",label:o.__("On Hold"),padding:"p-0",class:"flex flex-col overflow-hidden"},{default:b(()=>[m(p,{orders:c.orders,onSearchOrder:t[1]||(t[1]=u=>o.searchOrder(u)),onPreviewOrder:t[2]||(t[2]=u=>o.previewOrder(u)),onPrintOrder:t[3]||(t[3]=u=>o.printOrder(u)),onProceedOpenOrder:t[4]||(t[4]=u=>o.proceedOpenOrder(u))},null,8,["orders"])]),_:1},8,["label"])]),_:1},8,["active"])]),e("div",je,[Ve,e("div",null,[m($,{onClick:t[6]||(t[6]=u=>i.popup.close()),type:"info"},{default:b(()=>[h(r(o.__("Close")),1)]),_:1})])])])}const Le=g(Pe,[["render",Se]]),Ae={name:"ns-pos-pending-orders-button",methods:{__:a,openPendingOrdersPopup(){V.show(Le)}}},Ne={class:"ns-button default"},Be=e("i",{class:"mr-1 text-xl lar la-hand-pointer"},null,-1);function De(s,t,i,x,c,o){return l(),d("div",Ne,[e("button",{onClick:t[0]||(t[0]=n=>o.openPendingOrdersPopup()),class:"rounded shadow flex-shrink-0 h-12 flex items-center px-2 py-1 text-sm"},[Be,e("span",null,r(o.__("Orders")),1)])])}const Re=g(Ae,[["render",De]]);export{Re as default};

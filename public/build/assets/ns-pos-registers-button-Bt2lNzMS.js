import{F as j,p as B,v as I,b as P,a as C,d as k}from"./bootstrap-Cq4cdc46.js";import{n as N,a as F}from"./ns-prompt-popup-ncfXAYOx.js";import{n as O,_ as d}from"./currency-Dtag6qPd.js";import{_ as y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as f,o as l,c,a as e,t as r,b,e as p,j as m,F as x,f as v,w as H,g as T,n as S}from"./runtime-core.esm-bundler-fVX7Ok1h.js";import"./chart-CwFtjAqO.js";const A={components:{},props:["popup"],data(){return{amount:0,title:null,identifier:null,settingsSubscription:null,settings:null,action:null,register:null,loaded:!1,register_id:null,validation:new j,fields:[],isSubmitting:!1,denominations:[{label:"₱1000",value:0,multiplier:1e3},{label:"₱500",value:0,multiplier:500},{label:"₱200",value:0,multiplier:200},{label:"₱100",value:0,multiplier:100},{label:"₱50",value:0,multiplier:50},{label:"₱20",value:0,multiplier:20},{label:"₱10",value:0,multiplier:10},{label:"₱5",value:0,multiplier:5},{label:"₱1",value:0,multiplier:1}]}},mounted(){this.title=this.popup.params.title,this.identifier=this.popup.params.identifier,this.register=this.popup.params.register,this.action=this.popup.params.action,this.register_id=this.popup.params.register_id,this.settingsSubscription=POS.settings.subscribe(t=>{this.settings=t}),this.loadFields(),this.popupCloser()},unmounted(){this.settingsSubscription.unsubscribe()},methods:{popupCloser:B,nsCurrency:O,__:d,definedValue(t){this.amount=t},close(){this.popup.close()},loadFields(){this.loaded=!1,nsHttpClient.get(`/api/fields/${this.identifier}`).subscribe(t=>{this.loaded=!0,this.fields=t},t=>(this.loaded=!0,nsSnackBar.error(t.message,d("OKAY"),{duration:!1}).subscribe()))},submit(t){Popup.show(N,{title:d("Confirm Your Action"),message:this.popup.params.confirmMessage||d("Would you like to confirm your action."),onAction:s=>{s&&this.triggerSubmit()}})},triggerSubmit(){if(this.isSubmitting)return;this.isSubmitting=!0;const t=this.validation.extractFields(this.fields);t.amount=this.amount===""?0:this.amount,nsHttpClient.post(`/api/cash-registers/${this.action}/${this.register_id||this.settings.register.id}`,t).subscribe({next:s=>{this.popup.params.resolve(s),this.popup.close(),nsSnackBar.success(s.message).subscribe(),this.isSubmitting=!1},error:s=>{nsSnackBar.error(s.message).subscribe(),this.isSubmitting=!1}})}},computed:{amount(){return this.denominations.reduce((t,s)=>t+s.value*s.multiplier,0)}}},L={key:0,class:"shadow-lg w-95vw md:w-3/5-screen ns-box"},D={class:"border-b ns-box-header p-2 text-primary flex justify-between items-center"},U={class:"font-semibold"},z={class:"p-2"},Q={key:0,class:"mb-2 p-3 elevation-surface font-bold border text-right flex justify-between"},Y={class:"mb-2 p-3 elevation-surface success border font-bold text-right flex justify-between"},E={class:"flex flex-col md:flex-row md:-mx-2"},M={key:0,id:"app",class:"md:px-2 md:w-1/2 w-full"},q=e("br",null,null,-1),K=["onUpdate:modelValue"],W=["value"],G={key:1,class:"md:px-2 md:w-1/2 w-full"},J={class:"md:px-2 md:w-1/2 w-full"},X={key:1,class:"h-full w-full flex items-center justify-center"};function Z(t,s,a,u,n,i){const _=f("ns-close-button"),o=f("ns-numpad"),g=f("ns-field"),V=f("ns-spinner");return l(),c("div",null,[n.loaded?(l(),c("div",L,[e("div",D,[e("h3",U,r(n.title),1),e("div",null,[b(_,{onClick:s[0]||(s[0]=h=>i.close())})])]),e("div",z,[e("div",null,[n.register!==null?(l(),c("div",Q,[e("span",null,r(i.__("Balance")),1),e("span",null,r(i.nsCurrency(n.register.balance)),1)])):p("",!0),e("div",Y,[e("span",null,r(i.__("Input")),1),e("span",null,r(i.nsCurrency(i.amount)),1)])]),e("div",E,[n.action=="close"?(l(),c("div",M,[m(" Denomination "),q,(l(!0),c(x,null,v(n.denominations,(h,R)=>(l(),c("div",{class:"denomination",key:R},[e("label",null,r(h.label)+":",1),H(e("input",{type:"number","onUpdate:modelValue":$=>h.value=$,min:"0",placeholder:"0"},null,8,K),[[I,h.value,void 0,{number:!0}]])]))),128)),e("button",{onNext:s[1]||(s[1]=h=>i.submit(h)),value:t.test,onClick:s[2]||(s[2]=h=>i.definedValue(h))},"Submit",40,W)])):(l(),c("div",G,[b(o,{floating:!0,onNext:s[3]||(s[3]=h=>i.submit(h)),value:t.test,onChanged:s[4]||(s[4]=h=>i.definedValue(h))},null,8,["value"])])),e("div",J,[(l(!0),c(x,null,v(n.fields,(h,R)=>(l(),T(g,{field:h,key:R},null,8,["field"]))),128))])])])])):p("",!0),n.loaded?p("",!0):(l(),c("div",X,[b(V)]))])}const w=y(A,[["render",Z]]),ee={name:"ns-pos-cash-registers-popup",props:["popup"],components:{nsNumpad:F},data(){return{registers:[],priorVerification:!1,hasLoadedRegisters:!1,validation:new j,amount:0,settings:null,settingsSubscription:null}},mounted(){this.checkUsedRegister(),this.settingsSubscription=POS.settings.subscribe(t=>{this.settings=t})},beforeDestroy(){this.settingsSubscription.unsubscribe()},computed:{},methods:{__:d,popupResolver:P,async selectRegister(t){if(t.status!=="closed")return C.error(d("Unable to open this register. Only closed register can be opened.")).subscribe();try{const s=await new Promise((a,u)=>{const n=d("Open Register : %s").replace("%s",t.name),i="open",_=t.id;Popup.show(w,{resolve:a,reject:u,title:n,identifier:"ns.cash-registers-opening",register:t,action:i,register_id:_})});this.popupResolver(s)}catch(s){this.popup.reject(s)}},checkUsedRegister(){this.priorVerification=!1,k.get("/api/cash-registers/used").subscribe({next:t=>{this.popup.params.resolve(t),this.popup.close()},error:t=>{this.priorVerification=!0,C.error(t.message).subscribe(),this.loadRegisters()}})},loadRegisters(){this.hasLoadedRegisters=!1,k.get("/api/cash-registers").subscribe(t=>{this.registers=t,this.hasLoadedRegisters=!0})},getClass(t){switch(t.status){case"in-use":return"elevation-surface warning cursor-not-allowed";case"disabled":return"elevation-surface cursor-not-allowed";case"available":return"elevation-surface success"}return"elevation-surface hoverable cursor-pointer"}}},se={key:0,class:"h-full w-full py-10 flex justify-center items-center"},te={class:"title p-2 border-b ns-box-header flex justify-between items-center"},ie={class:"font-semibold"},re={key:0},ne=["href"],oe={key:0,class:"py-10 flex-auto overflow-y-auto flex items-center justify-center"},le={key:1,class:"flex-auto overflow-y-auto"},ce={class:"grid grid-cols-3"},ae=["onClick"],ue=e("i",{class:"las la-cash-register text-6xl"},null,-1),de={class:"text-semibold text-center"},pe={class:"text-sm"},he={key:0,class:"p-2 alert text-white"},_e=["href"];function ge(t,s,a,u,n,i){const _=f("ns-spinner");return l(),c("div",null,[n.priorVerification===!1?(l(),c("div",se,[b(_,{size:"24",border:"8"})])):p("",!0),n.priorVerification?(l(),c("div",{key:1,id:"ns-pos-cash-registers-popup",class:S(["w-95vw md:w-3/5-screen lg:w-3/5-screen xl:w-2/5-screen flex flex-col overflow-hidden",n.priorVerification?"shadow-lg ns-box":""])},[e("div",te,[e("h3",ie,r(i.__("Open The Cash Register")),1),n.settings?(l(),c("div",re,[e("a",{href:n.settings.urls.orders_url,class:"rounded-full border ns-close-button px-3 text-sm py-1"},r(i.__("Exit To Orders")),9,ne)])):p("",!0)]),n.hasLoadedRegisters?p("",!0):(l(),c("div",oe,[b(_,{size:"16",border:"4"})])),n.hasLoadedRegisters?(l(),c("div",le,[e("div",ce,[(l(!0),c(x,null,v(n.registers,(o,g)=>(l(),c("div",{onClick:V=>i.selectRegister(o),class:S([i.getClass(o),"border flex items-center justify-center flex-col p-3"]),key:g},[ue,e("h3",de,r(o.name),1),e("span",pe,"("+r(o.status_label)+")",1)],10,ae))),128))]),n.registers.length===0?(l(),c("div",he,[m(r(i.__("Looks like there is no registers. At least one register is required to proceed."))+" — ",1),e("a",{class:"font-bold hover:underline",href:n.settings.urls.registers_url},r(i.__("Create Cash Register")),9,_e)])):p("",!0)])):p("",!0)],2)):p("",!0)])}const fe=y(ee,[["render",ge]]),be={props:["popup"],data(){return{totalIn:0,totalOut:0,settings:null,settingsSubscription:null,cashRegisterReport:[]}},mounted(){this.settingsSubscription=POS.settings.subscribe(t=>{this.settings=t}),this.getHistory()},unmounted(){this.settingsSubscription.unsubscribe()},methods:{__:d,nsCurrency:O,popupResolver:P,closePopup(){this.popupResolver({status:"success"})},getHistory(){k.get(`/api/cash-registers/session-history/${this.settings.register.id}`).subscribe(t=>{this.cashRegisterReport=t,this.totalIn=this.cashRegisterReport.history.filter(s=>["register-opening","register-sale","register-cash-in"].includes(s.action)).map(s=>parseFloat(s.value)).reduce((s,a)=>s+a,0),this.totalOut=this.cashRegisterReport.history.filter(s=>["register-change","register-closing","register-refund","register-cash-out"].includes(s.action)).map(s=>parseFloat(s.value)).reduce((s,a)=>s+a,0)})}}},me={class:"ns-box shadow-lg w-95vw md:w-4/6-screen lg:w-half overflow-hidden"},xe={id:"header",class:"p-2 flex justify-between items-center ns-box-header"},ve={class:"font-bold"},ye={class:"flex w-full ns-box-body"},we={class:"flex flex-auto"},Ce={class:"w-full md:w-1/2 text-right bg-success-secondary text-white font-bold text-3xl p-3"},Re={class:"w-full md:w-1/2 text-right bg-error-secondary text-white font-bold text-3xl p-3"},ke={class:"flex flex-col overflow-y-auto h-120"},Se={class:"p-2 flex-auto"},Pe={class:"flex-auto text-right p-2"},Oe={class:"p-2 flex-auto"},Ve={class:"flex md:-mx-1"},je={class:"px-1 text-xs text-secondary"},Be={class:"px-1 text-xs text-secondary"},$e={class:"flex-auto text-right p-2"},Ie={class:"p-2 flex-auto"},Ne={class:"flex-auto text-right p-2"},Fe={class:"p-2 flex-auto"},He={class:"flex-auto text-right p-2"},Te={class:"p-2 flex-auto"},Ae={class:"flex md:-mx-1"},Le={class:"px-1 text-xs text-secondary"},De={class:"px-1 text-xs text-secondary"},Ue={class:"flex-auto text-right p-2"},ze={class:"summary border-t border-box-edge"},Qe={class:"p-2 flex-auto"},Ye={class:"flex-auto text-right p-2"};function Ee(t,s,a,u,n,i){const _=f("ns-close-button");return l(),c("div",me,[e("div",xe,[e("h3",ve,r(i.__("Register History")),1),e("div",null,[b(_,{onClick:i.closePopup},null,8,["onClick"])])]),e("div",ye,[e("div",we,[e("div",Ce,r(i.nsCurrency(n.totalIn)),1),e("div",Re,r(i.nsCurrency(n.totalOut)),1)])]),e("div",ke,[(l(!0),c(x,null,v(n.cashRegisterReport.history,o=>(l(),c(x,null,[["register-sale"].includes(o.action)?(l(),c("div",{key:o.id,class:"flex border-b elevation-surface success"},[e("div",Se,r(o.description),1),e("div",Pe,r(i.nsCurrency(o.value)),1)])):p("",!0),["register-cash-in"].includes(o.action)?(l(),c("div",{key:o.id,class:"flex border-b elevation-surface success"},[e("div",Oe,[e("div",null,r(o.description||i.__("Not Provided")),1),e("div",Ve,[e("div",je,[e("strong",null,r(i.__("Type")),1),m(": "+r(o.label),1)]),e("div",Be,[e("strong",null,r(i.__("Account")),1),m(": "+r(o.account_name),1)])])]),e("div",$e,r(i.nsCurrency(o.value)),1)])):p("",!0),["register-opening"].includes(o.action)?(l(),c("div",{key:o.id,class:"flex border-b elevation-surface"},[e("div",Ie,r(o.label),1),e("div",Ne,r(i.nsCurrency(o.value)),1)])):p("",!0),["register-close"].includes(o.action)?(l(),c("div",{key:o.id,class:"flex border-b elevation-surface info"},[e("div",Fe,r(o.label),1),e("div",He,r(i.nsCurrency(o.value)),1)])):p("",!0),["register-refund","register-cash-out"].includes(o.action)?(l(),c("div",{key:o.id,class:"flex border-b elevation-surface error"},[e("div",Te,[e("div",null,r(o.description),1),e("div",Ae,[e("div",Le,[e("strong",null,r(i.__("Type")),1),m(": "+r(o.label),1)]),e("div",De,[e("strong",null,r(i.__("Account")),1),m(": "+r(o.account_name),1)])])]),e("div",Ue,r(i.nsCurrency(o.value)),1)])):p("",!0)],64))),256))]),e("div",ze,[(l(!0),c(x,null,v(n.cashRegisterReport.summary,o=>(l(),c("div",{class:S(["flex border-b elevation-surface",o.color])},[e("div",Qe,r(o.label),1),e("div",Ye,r(i.nsCurrency(o.value)),1)],2))),256))])])}const Me=y(be,[["render",Ee]]),qe={props:["popup"],mounted(){this.settingsSubscriber=POS.settings.subscribe(t=>{this.settings=t}),this.popupCloser(),this.loadRegisterSummary()},beforeDestroy(){this.settingsSubscriber.unsubscribe()},data(){return{settings:null,settingsSubscriber:null,register:{}}},methods:{__:d,nsCurrency:O,popupResolver:P,popupCloser:B,loadRegisterSummary(){if(this.settings.register===void 0)return setTimeout(()=>{this.popup.close()},500),C.error(d("The register is not yet loaded.")).subscribe();nsHttpClient.get(`/api/cash-registers/${this.settings.register.id}`).subscribe(t=>{this.register=t})},closePopup(){this.popupResolver({status:"error",button:"close_popup"})},async closeCashRegister(t){try{const s=await new Promise((a,u)=>{Popup.show(w,{title:d("Close Register"),action:"close",identifier:"ns.cash-registers-closing",register:t,resolve:a,reject:u})});POS.unset("register"),this.popupResolver({button:"close_register",...s})}catch(s){throw s}},async cashIn(t){try{const s=await new Promise((a,u)=>{Popup.show(w,{title:d("Cash In"),action:"register-cash-in",register:t,identifier:"ns.cash-registers-cashing",resolve:a,reject:u})});this.popupResolver({button:"close_register",...s})}catch(s){console.log({exception:s})}},async cashOut(t){try{const s=await new Promise((a,u)=>{Popup.show(w,{title:d("Cash Out"),action:"register-cash-out",register:t,identifier:"ns.cash-registers-cashout",resolve:a,reject:u})});this.popupResolver({button:"close_register",...s})}catch(s){throw s}},async historyPopup(t){try{const s=await new Promise((a,u)=>{Popup.show(Me,{resolve:a,reject:u,register:t})})}catch(s){throw s}}}},Ke={class:"shadow-lg w-95vw md:w-3/5-screen lg:w-2/4-screen ns-box"},We={class:"p-2 border-b ns-box-header flex items-center justify-between"},Ge={key:0},Je={class:"h-16 text-3xl elevation-surface info flex items-center justify-between px-3"},Xe={class:""},Ze={class:"font-bold"},es={class:"h-16 text-3xl elevation-surface success flex items-center justify-between px-3"},ss={class:""},ts={class:"font-bold"},is={key:1,class:"h-32 ns-box-body border-b py-1 flex items-center justify-center"},rs={class:"grid grid-cols-2 text-primary"},ns=e("i",{class:"las la-sign-out-alt text-6xl"},null,-1),os={class:"text-xl font-bold"},ls=e("i",{class:"las la-plus-circle text-6xl"},null,-1),cs={class:"text-xl font-bold"},as=e("i",{class:"las la-minus-circle text-6xl"},null,-1),us={class:"text-xl font-bold"},ds=e("i",{class:"las la-history text-6xl"},null,-1),ps={class:"text-xl font-bold"};function hs(t,s,a,u,n,i){const _=f("ns-close-button"),o=f("ns-spinner");return l(),c("div",Ke,[e("div",We,[e("h3",null,r(i.__("Register Options")),1),e("div",null,[b(_,{onClick:s[0]||(s[0]=g=>i.closePopup())})])]),n.register.total_sale_amount!==void 0&&n.register.balance!==void 0?(l(),c("div",Ge,[e("div",Je,[e("span",Xe,r(i.__("Sales")),1),e("span",Ze,r(i.nsCurrency(n.register.total_sale_amount)),1)]),e("div",es,[e("span",ss,r(i.__("Balance")),1),e("span",ts,r(i.nsCurrency(n.register.balance)),1)])])):p("",!0),n.register.total_sale_amount===void 0&&n.register.balance===void 0?(l(),c("div",is,[e("div",null,[b(o,{border:"4",size:"16"})])])):p("",!0),e("div",rs,[e("div",{onClick:s[1]||(s[1]=g=>i.closeCashRegister(n.register)),class:"border-r border-b py-4 ns-numpad-key info cursor-pointer px-2 flex items-center justify-center flex-col"},[ns,e("h3",os,r(i.__("Close")),1)]),e("div",{onClick:s[2]||(s[2]=g=>i.cashIn(n.register)),class:"ns-numpad-key success border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col"},[ls,e("h3",cs,r(i.__("Cash In")),1)]),e("div",{onClick:s[3]||(s[3]=g=>i.cashOut(n.register)),class:"ns-numpad-key error border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col"},[as,e("h3",us,r(i.__("Cash Out")),1)]),e("div",{onClick:s[4]||(s[4]=g=>i.historyPopup(n.register)),class:"ns-numpad-key info border-r border-b py-4 cursor-pointer px-2 flex items-center justify-center flex-col"},[ds,e("h3",ps,r(i.__("History")),1)])])])}const _s=y(qe,[["render",hs]]),gs={data(){return{order:null,name:"",selectedRegister:null,orderSubscriber:null,settingsSubscriber:null}},watch:{},methods:{__:d,async openRegisterOptions(){try{(await new Promise((s,a)=>{Popup.show(_s,{resolve:s,reject:a})})).button==="close_register"&&(delete this.settings.register,POS.settings.next(this.settings),POS.reset())}catch(t){Object.keys(t).length>0&&C.error(t.message).subscribe()}},registerInitialQueue(){POS.initialQueue.push(()=>new Promise(async(t,s)=>{try{const a=await new Promise((u,n)=>{if(this.settings.register===void 0)return Popup.show(fe,{resolve:u,reject:n});u({data:{register:this.settings.register}})});POS.set("register",a.data.register),this.setRegister(a.data.register),t(a)}catch(a){if(a===!1)return s({status:"error",message:d("You must choose a register before proceeding.")});s(a)}}))},setButtonName(){if(this.settings.register===void 0)return this.name=d("Cash Register");this.name=d("Cash Register : {register}").replace("{register}",this.settings.register.name)},setRegister(t){if(t!==void 0){const s=POS.order.getValue();s.register_id=t.id,POS.order.next(s)}}},unmounted(){this.orderSubscriber.unsubscribe(),this.settingsSubscriber.unsubscribe()},mounted(){this.registerInitialQueue(),this.orderSubscriber=POS.order.subscribe(t=>{this.order=t}),this.settingsSubscriber=POS.settings.subscribe(t=>{this.settings=t,this.setRegister(this.settings.register),this.setButtonName()})}},fs={class:"ns-button default"},bs=e("i",{class:"mr-1 text-xl las la-cash-register"},null,-1);function ms(t,s,a,u,n,i){return l(),c("div",fs,[e("button",{onClick:s[0]||(s[0]=_=>i.openRegisterOptions()),class:"rounded shadow flex-shrink-0 h-12 flex items-center px-2 py-1 text-sm"},[bs,e("span",null,r(n.name),1)])])}const ks=y(gs,[["render",ms]]);export{ks as default};

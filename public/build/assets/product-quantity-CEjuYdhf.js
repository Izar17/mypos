var I=Object.defineProperty;var B=(t,o,u)=>o in t?I(t,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):t[o]=u;var Q=(t,o,u)=>(B(t,typeof o!="symbol"?o+"":o,u),u);import{b as S,a as w}from"./bootstrap-B9n0c8ym.js";import{j as W,d as T,p as j,v as N,w as q,i as P,X as M}from"./tax-Ce1VQMwg.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as m,o as r,c as l,b as e,t as i,e as p,f as d,F as g,g as k,h as L,i as x,k as C,j as X,w as R,n as A}from"./runtime-core.esm-bundler-DHuczvMQ.js";import{_ as h,n as D}from"./currency-gBUix5n2.js";import{i as K,k as J,n as U,a as Y,j as G}from"./ns-prompt-popup-BUjip02s.js";import{n as Z}from"./ns-orders-preview-popup-Bio7L4Lb.js";const $={mounted(){this.closeWithOverlayClicked(),this.loadTransactionFields()},props:["popup"],data(){return{fields:[],isSubmiting:!1,formValidation:new W}},methods:{__:h,closeWithOverlayClicked:T,proceed(){const t=this.popup.params.customer,o=this.formValidation.extractFields(this.fields);this.isSubmiting=!0,S.post(`/api/customers/${t.id}/account-history`,o).subscribe({next:u=>{this.isSubmiting=!1,w.success(u.message).subscribe(),this.popup.params.resolve(u),this.popup.close()},error:u=>{this.isSubmiting=!1,w.error(u.message).subscribe(),this.popup.params.reject(u)}})},close(){this.popup.close(),this.popup.params.reject(!1)},loadTransactionFields(){S.get("/api/fields/ns.customers-account").subscribe({next:t=>{this.fields=this.formValidation.createFields(t)}})}}},ee={class:"w-6/7-screen md:w-5/7-screen lg:w-4/7-screen h-6/7-screen md:h-5/7-screen lg:h-5/7-screen overflow-hidden shadow-lg ns-box flex flex-col relative"},se={class:"p-2 border-b ns-box-header flex justify-between items-center"},te={class:"font-semibold"},oe={class:"flex-auto overflow-y-auto"},ne={key:0,class:"h-full w-full flex items-center justify-center"},ie={key:1,class:"p-2"},re={class:"p-2 ns-box-footer justify-between border-t flex"},le=e("div",null,null,-1),ce={class:"px-1"},ue={class:"-mx-2 flex flex-wrap"},de={class:"px-1"},ae={class:"px-1"},_e={key:0,class:"h-full w-full absolute flex items-center justify-center",style:{background:"rgb(0 98 171 / 45%)"}};function pe(t,o,u,f,n,s){const y=m("ns-close-button"),c=m("ns-spinner"),b=m("ns-field"),v=m("ns-button");return r(),l("div",ee,[e("div",se,[e("h2",te,i(s.__("New Transaction")),1),e("div",null,[p(y,{onClick:o[0]||(o[0]=a=>s.close())})])]),e("div",oe,[n.fields.length===0?(r(),l("div",ne,[p(c)])):d("",!0),n.fields.length>0?(r(),l("div",ie,[(r(!0),l(g,null,k(n.fields,(a,O)=>(r(),L(b,{field:a,key:O},null,8,["field"]))),128))])):d("",!0)]),e("div",re,[le,e("div",ce,[e("div",ue,[e("div",de,[p(v,{type:"error",onClick:o[1]||(o[1]=a=>s.close())},{default:x(()=>[C(i(s.__("Close")),1)]),_:1})]),e("div",ae,[p(v,{type:"info",onClick:o[2]||(o[2]=a=>s.proceed())},{default:x(()=>[C(i(s.__("Proceed")),1)]),_:1})])])])]),n.isSubmiting===0?(r(),l("div",_e,[p(c)])):d("",!0)])}const he=V($,[["render",pe]]),fe={name:"ns-pos-coupons-load-popup",props:["popup"],components:{nsNotice:K},data(){return{placeHolder:h("Coupon Code"),couponCode:null,order:null,activeTab:"apply-coupon",orderSubscriber:null,coupon:null}},mounted(){this.popupCloser(),this.orderSubscriber=POS.order.subscribe(t=>{this.order=X(t),this.order.coupons.length>0&&(this.activeTab="active-coupons")}),this.popup.params&&this.popup.params.apply_coupon&&(this.couponCode=this.popup.params.apply_coupon,this.getCoupon(this.couponCode).subscribe({next:t=>{this.coupon=t,this.apply()}}))},unmounted(){this.orderSubscriber.unsubscribe()},methods:{__:h,popupCloser:T,popupResolver:j,selectCustomer(){Popup.show(z)},cancel(){this.coupon=null,this.couponCode=null},removeCoupon(t){this.order.coupons.splice(t,1),POS.refreshCart()},apply(){try{if(this.coupon.valid_hours_start!==null&&!ns.date.moment.isAfter(this.coupon.valid_hours_start)&&this.coupon.valid_hours_start.length>0)return w.error(h("The coupon is out from validity date range.")).subscribe();if(this.coupon.valid_hours_end!==null&&!ns.date.moment.isBefore(this.coupon.valid_hours_end)&&this.coupon.valid_hours_end.length>0)return w.error(h("The coupon is out from validity date range.")).subscribe();const t=this.coupon.products;if(t.length>0){const f=t.map(n=>n.product_id);if(this.order.products.filter(n=>f.includes(n.product_id)).length===0)return w.error(h("This coupon requires products that aren't available on the cart at the moment.")).subscribe()}const o=this.coupon.categories;if(o.length>0){const f=o.map(n=>n.category_id);if(this.order.products.filter(n=>f.includes(n.$original().category_id)).length===0)return w.error(h("This coupon requires products that belongs to specific categories that aren't included at the moment.").replace("%s")).subscribe()}let u={customer_coupon_id:this.coupon.customer_coupon.length>0?this.coupon.customer_coupon[0].id:0,minimum_cart_value:this.coupon.minimum_cart_value,maximum_cart_value:this.coupon.maximum_cart_value,name:this.coupon.name,type:this.coupon.type,value:0,coupon_id:this.coupon.id,limit_usage:this.coupon.limit_usage,code:this.coupon.code,discount_value:this.coupon.discount_value,categories:this.coupon.categories,products:this.coupon.products};this.cancel(),POS.pushCoupon(u),this.activeTab="active-coupons",setTimeout(()=>{this.popupResolver(u)},500),w.success(h("The coupon has applied to the cart.")).subscribe()}catch(t){console.log(t)}},getCouponType(t){switch(t){case"percentage_discount":return h("Percentage");case"flat_discount":return h("Flat");default:return h("Unknown Type")}},getDiscountValue(t){switch(t.type){case"percentage_discount":return t.discount_value+"%";case"flat_discount":return this.$options.filters.currency(t.discount_value)}},closePopup(){this.popupResolver(!1)},setActiveTab(t){this.activeTab=t,t==="apply-coupon"&&setTimeout(()=>{document.querySelector(".coupon-field").select()},10)},getCoupon(t){return!this.order.customer_id>0?w.error(h("You must select a customer before applying a coupon.")):S.post(`/api/customers/coupons/${t}`,{customer_id:this.order.customer_id})},loadCoupon(){const t=this.couponCode;this.getCoupon(t).subscribe({next:o=>{this.coupon=o,w.success(h("The coupon has been loaded.")).subscribe()},error:o=>{w.error(o.message||h("An unexpected error occurred.")).subscribe()}})}}},me={class:"shadow-lg ns-box w-95vw md:w-3/6-screen lg:w-2/6-screen"},be={class:"border-b ns-box-header p-2 flex justify-between items-center"},xe={class:"font-bold"},ye={class:"p-1 ns-box-body"},ve={class:"border-2 input-group info rounded flex"},ge=["placeholder"],we={class:"pt-2"},Ce={key:0,class:"pt-2 flex"},ke={key:1,class:"pt-2"},Pe={class:"overflow-hidden"},Se={key:0,class:"pt-2 fade-in-entrance anim-duration-500 overflow-y-auto ns-scrollbar h-64"},Te={class:"w-full ns-table"},Ve={class:"p-2 w-1/2 border"},je={class:"p-2 w-1/2 border"},Oe={class:"p-2 w-1/2 border"},Le={class:"p-2 w-1/2 border"},Ae={class:"p-2 w-1/2 border"},Ne={class:"p-2 w-1/2 border"},Re={class:"p-2 w-1/2 border"},He={class:"p-2 w-1/2 border"},Fe={class:"p-2 w-1/2 border"},qe={class:"p-2 w-1/2 border"},De={class:"p-2 w-1/2 border"},Qe={class:"p-2 w-1/2 border"},Ue={key:0},We={class:"p-2 w-1/2 border"},ze={class:"p-2 w-1/2 border"},Ee={key:0},Ie={key:0},Be={class:"flex-auto"},Me={class:"font-semibold text-primary p-2 flex justify-between"},Xe={key:0,class:"flex justify-between elevation-surface border items-center p-2"},Ke={key:0,class:"flex"};function Je(t,o,u,f,n,s){const y=m("ns-close-button"),c=m("ns-notice"),b=m("ns-tabs-item"),v=m("ns-tabs");return r(),l("div",me,[e("div",be,[e("h3",xe,i(s.__("Load Coupon")),1),e("div",null,[p(y,{onClick:o[0]||(o[0]=a=>s.closePopup())})])]),e("div",ye,[p(v,{onActive:o[5]||(o[5]=a=>s.setActiveTab(a)),active:n.activeTab},{default:x(()=>[p(b,{label:s.__("Apply A Coupon"),padding:"p-2",identifier:"apply-coupon"},{default:x(()=>[e("div",ve,[R(e("input",{ref:"coupon",onKeyup:o[1]||(o[1]=q(a=>s.loadCoupon(),["enter"])),"onUpdate:modelValue":o[2]||(o[2]=a=>n.couponCode=a),type:"text",class:"coupon-field w-full text-primary p-2 outline-none",placeholder:n.placeHolder},null,40,ge),[[N,n.couponCode]]),e("button",{onClick:o[3]||(o[3]=a=>s.loadCoupon()),class:"px-3 py-2"},i(s.__("Load")),1)]),e("div",we,[p(c,{color:"info"},{description:x(()=>[C(i(s.__("Input the coupon code that should apply to the POS. If a coupon is issued for a customer, that customer must be selected priorly.")),1)]),_:1})]),n.order&&n.order.customer_id===void 0?(r(),l("div",Ce,[e("button",{onClick:o[4]||(o[4]=a=>s.selectCustomer()),class:"w-full border p-2 outline-none ns-numpad-key info cursor-pointer text-center"},i(s.__("Click here to choose a customer.")),1)])):d("",!0),n.order&&n.order.customer_id!==void 0?(r(),l("div",ke,[p(c,{color:"success"},{description:x(()=>[C(i(s.__("Loading Coupon For : ")+`${n.order.customer.first_name} ${n.order.customer.last_name}`),1)]),_:1})])):d("",!0),e("div",Pe,[n.coupon?(r(),l("div",Se,[e("table",Te,[e("tbody",null,[e("tr",null,[e("td",Ve,i(s.__("Coupon Name")),1),e("td",je,i(n.coupon.name),1)]),e("tr",null,[e("td",Oe,i(s.__("Discount"))+" ("+i(s.getCouponType(n.coupon.type))+")",1),e("td",Le,i(s.getDiscountValue(n.coupon)),1)]),e("tr",null,[e("td",Ae,i(s.__("Usage")),1),e("td",Ne,i((n.coupon.customer_coupon.length>0?n.coupon.customer_coupon[0].usage:0)+"/"+(n.coupon.limit_usage||s.__("Unlimited"))),1)]),e("tr",null,[e("td",Re,i(s.__("Valid From")),1),e("td",He,i(n.coupon.valid_hours_start||s.__("N/A")),1)]),e("tr",null,[e("td",Fe,i(s.__("Valid Till")),1),e("td",qe,i(n.coupon.valid_hours_end||s.__("N/A")),1)]),e("tr",null,[e("td",De,i(s.__("Categories")),1),e("td",Qe,[e("ul",null,[(r(!0),l(g,null,k(n.coupon.categories,a=>(r(),l("li",{class:"rounded-full px-3 py-1 border",key:a.id},i(a.category.name),1))),128)),n.coupon.categories.length===0?(r(),l("li",Ue,i(s.__("Not applicable")),1)):d("",!0)])])]),e("tr",null,[e("td",We,i(s.__("Products")),1),e("td",ze,[e("ul",null,[(r(!0),l(g,null,k(n.coupon.products,a=>(r(),l("li",{class:"rounded-full px-3 py-1 border",key:a.id},i(a.product.name),1))),128)),n.coupon.products.length===0?(r(),l("li",Ee,i(s.__("Not applicable")),1)):d("",!0)])])])])])])):d("",!0)])]),_:1},8,["label"]),p(b,{label:s.__("Active Coupons"),padding:"p-1",identifier:"active-coupons"},{default:x(()=>[n.order?(r(),l("ul",Ie,[(r(!0),l(g,null,k(n.order.coupons,(a,O)=>(r(),l("li",{key:O,class:"flex justify-between elevation-surface border items-center px-2 py-1"},[e("div",Be,[e("h3",Me,[e("span",null,i(a.name),1),e("span",null,i(s.getDiscountValue(a)),1)])]),e("div",null,[p(y,{onClick:H=>s.removeCoupon(O)},null,8,["onClick"])])]))),128)),n.order.coupons.length===0?(r(),l("li",Xe,i(s.__("No coupons applies to the cart.")),1)):d("",!0)])):d("",!0)]),_:1},8,["label"])]),_:1},8,["active"])]),n.coupon?(r(),l("div",Ke,[e("button",{onClick:o[6]||(o[6]=a=>s.apply()),class:"w-1/2 px-3 py-2 bg-success-tertiary text-white font-bold"},i(s.__("Apply")),1),e("button",{onClick:o[7]||(o[7]=a=>s.cancel()),class:"w-1/2 px-3 py-2 bg-error-tertiary text-white font-bold"},i(s.__("Cancel")),1)])):d("",!0)])}const Ye=V(fe,[["render",Je]]),Ge={name:"ns-pos-customers",props:["popup"],data(){return{activeTab:"create-customers",customer:null,subscription:null,orders:[],options:{},optionsSubscriber:null,selectedTab:"orders",isLoadingCoupons:!1,isLoadingRewards:!1,isLoadingHistory:!1,isLoadingOrders:!1,coupons:[],userCan:t=>POS.userCan(t),rewardsResponse:[],order:null,walletHistories:[]}},components:{nsPaginate:J},unmounted(){this.subscription.unsubscribe(),this.optionsSubscriber.unsubscribe()},mounted(){this.closeWithOverlayClicked(),this.optionsSubscriber=POS.options.subscribe(t=>{this.options=t}),this.subscription=POS.order.subscribe(t=>{this.order=t,this.popup.params.customer!==void 0?(this.activeTab="account-payment",this.customer=this.popup.params.customer,this.loadCustomerOrders()):t.customer!==void 0&&(this.activeTab="account-payment",this.customer=t.customer,this.loadCustomerOrders())}),this.popupCloser()},methods:{__:h,nsCurrency:D,reload(){this.loadCustomerOrders()},popupResolver:j,popupCloser:T,getWalletHistoryLabel(t){switch(t){case"add":return h("Crediting");case"deduct":return h("Removing");case"refund":return h("Refunding");case"payment":return h("Payment");default:return h("Unknow")}},getType(t){switch(t){case"percentage_discount":return h("Percentage Discount");case"flat_discount":return h("Flat Discount")}},closeWithOverlayClicked:T,async openOrderOptions(t){try{const o=await new Promise((u,f)=>{P.show(Z,{order:t,resolve:u,reject:f})});this.reload()}catch{w.error(h("An error occurred while opening the order options")).subscribe()}},doChangeTab(t){this.selectedTab=t,t==="coupons"&&this.loadCoupons(),t==="rewards"&&this.loadRewards(),t==="wallet-history"&&this.loadAccounHistory(),t==="orders"&&this.loadCustomerOrders()},loadAccounHistory(){this.isLoadingHistory=!0,S.get(`/api/customers/${this.customer.id}/account-history`).subscribe({next:t=>{this.walletHistories=t.data,this.isLoadingHistory=!1},error:t=>{this.isLoadingHistory=!1}})},loadCoupons(){this.isLoadingCoupons=!0,S.get(`/api/customers/${this.customer.id}/coupons`).subscribe({next:t=>{this.coupons=t,this.isLoadingCoupons=!1},error:t=>{this.isLoadingCoupons=!1}})},loadRewards(t=`/api/customers/${this.customer.id}/rewards`){this.isLoadingRewards=!0,S.get(t).subscribe({next:o=>{this.rewardsResponse=o,this.isLoadingRewards=!1},error:o=>{this.isLoadingRewards=!1}})},prefillForm(t){this.popup.params.name!==void 0&&(t.main.value=this.popup.params.name)},openCustomerSelection(){this.popup.close(t=>{P.show(z)})},loadCustomerOrders(){this.isLoadingOrders=!0,S.get(`/api/customers/${this.customer.id}/orders`).subscribe({next:t=>{this.orders=t,this.isLoadingOrders=!1},error:t=>{this.isLoadingOrders=!1}})},newTransaction(t){new Promise((u,f)=>{P.show(he,{customer:t,resolve:u,reject:f})}).then(u=>{POS.loadCustomer(t.id).subscribe(f=>{POS.selectCustomer(f)})})},applyCoupon(t){this.order.customer===void 0?P.show(U,{title:h("Use Customer ?"),message:h("No customer is selected. Would you like to proceed with this customer ?"),onAction:o=>{o&&POS.selectCustomer(this.customer).then(u=>{this.proceedApplyingCoupon(t)})}}):this.order.customer.id===this.customer.id?this.proceedApplyingCoupon(t):this.order.customer.id!==this.customer.id&&P.show(U,{title:h("Change Customer ?"),message:h("Would you like to assign this customer to the ongoing order ?"),onAction:o=>{o&&POS.selectCustomer(this.customer).then(u=>{this.proceedApplyingCoupon(t)})}})},proceedApplyingCoupon(t){new Promise((o,u)=>{P.show(Ye,{apply_coupon:t.code,resolve:o,reject:u})}).then(o=>{this.popupResolver(!1)}).catch(o=>{})},handleSavedCustomer(t){w.success(t.message).subscribe(),POS.selectCustomer(t.data.entry),this.popup.close()}}},Ze={id:"ns-pos-customers",class:"shadow-lg rounded w-95vw h-95vh lg:w-3/5-screen flex flex-col overflow-hidden"},$e={class:"ns-header p-2 flex justify-between items-center border-b"},es={class:"font-semibold"},ss={class:"ns-body flex-auto flex p-2 overflow-y-auto"},ts={key:1,class:"h-full flex-col w-full flex items-center justify-center text-primary"},os=e("i",{class:"lar la-hand-paper ns-icon text-6xl"},null,-1),is={class:"font-medium text-2xl"},rs={key:0,class:"flex-auto w-full flex items-center justify-center flex-col p-4"},ls=e("i",{class:"lar la-frown text-6xl"},null,-1),cs={class:"font-medium text-2xl"},us={class:"my-2"},ds={key:1,class:"flex flex-col flex-auto"},as={class:"flex-auto p-2 flex flex-col"},_s={class:"flex flex-wrap"},ps={class:"px-4 mb-4 w-full"},hs={class:"font-semibold"},fs={class:"flex flex-wrap ns-tab-cards -mx-2 w-full"},ms={class:"px-2 mb-4 w-full md:w-1/4 flex"},bs={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-success-secondary to-green-700 p-2 flex flex-col text-white"},xs={class:"font-medium text-lg"},ys={class:"w-full flex justify-end"},vs={class:"font-bold"},gs={class:"px-2 mb-4 w-full md:w-1/4 flex"},ws={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-error-secondary to-red-700 p-2 text-white"},Cs={class:"font-medium text-lg"},ks={class:"w-full flex justify-end"},Ps={class:"font-bold"},Ss={class:"px-2 mb-4 w-full md:w-1/4 flex"},Ts={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-blue-500 to-blue-700 p-2 text-white"},Vs={class:"font-medium text-lg"},js={class:"w-full flex justify-end"},Os={class:"font-bold"},Ls={class:"px-2 mb-4 w-full md:w-1/4 flex"},As={class:"rounded-lg shadow w-full bg-transparent bg-gradient-to-br from-teal-500 to-teal-700 p-2 text-white"},Ns={class:"font-medium text-lg"},Rs={class:"w-full flex justify-end"},Hs={class:"font-bold"},Fs={class:"flex flex-auto flex-col overflow-hidden"},qs={key:0,class:"flex-auto h-full justify-center flex items-center"},Ds={class:"py-2 w-full"},Qs={class:"font-semibold text-primary"},Us={class:"flex-auto flex-col flex overflow-hidden"},Ws={class:"flex-auto overflow-y-auto"},zs={class:"table ns-table w-full"},Es={class:"text-primary"},Is={colspan:"3",width:"150",class:"p-2 border font-semibold"},Bs={width:"50",class:"p-2 border font-semibold"},Ms={class:"text-primary"},Xs={key:0},Ks={class:"border p-2 text-center",colspan:"4"},Js={colspan:"3",class:"border p-2 text-center"},Ys={class:"flex flex-col items-start"},Gs={class:"font-bold"},Zs={class:"md:-mx-2 w-full flex flex-col md:flex-row"},$s={class:"md:px-2 flex items-start w-full md:w-1/4"},et={class:"md:px-2 flex items-start w-full md:w-1/4"},st={class:"md:px-2 flex items-start w-full md:w-1/4"},tt={class:"border p-2 text-center"},ot=["onClick"],nt=e("i",{class:"las la-wallet"},null,-1),it={class:"ml-1"},rt={key:0,class:"flex-auto h-full justify-center flex items-center"},lt={class:"py-2 w-full"},ct={class:"font-semibold text-primary"},ut={class:"flex-auto flex-col flex overflow-hidden"},dt={class:"flex-auto overflow-y-auto"},at={class:"table ns-table w-full"},_t={class:"text-primary"},pt={colspan:"3",width:"150",class:"p-2 border font-semibold"},ht={class:"text-primary"},ft={key:0},mt={class:"border p-2 text-center",colspan:"3"},bt={colspan:"3",class:"border p-2 text-center"},xt={class:"flex flex-col items-start"},yt={class:"font-bold"},vt={class:"md:-mx-2 w-full flex flex-col md:flex-row"},gt={class:"md:px-2 flex items-start w-full md:w-1/3"},wt={class:"md:px-2 flex items-start w-full md:w-1/3"},Ct={key:0,class:"flex-auto h-full justify-center flex items-center"},kt={class:"py-2 w-full"},Pt={class:"font-semibold text-primary"},St={class:"flex-auto flex-col flex overflow-hidden"},Tt={class:"flex-auto overflow-y-auto"},Vt={class:"table ns-table w-full"},jt={class:"text-primary"},Ot={width:"150",class:"p-2 border font-semibold"},Lt={class:"p-2 border font-semibold"},At=e("th",{class:"p-2 border font-semibold"},null,-1),Nt={class:"text-primary text-sm"},Rt={key:0},Ht={class:"border p-2 text-center",colspan:"4"},Ft={width:"300",class:"border p-2"},qt={class:""},Dt={class:"-mx-2 flex"},Qt={class:"text-xs text-primary px-2"},Ut={class:"text-xs text-primary px-2"},Wt={class:"border p-2 text-center"},zt={key:0},Et={key:1},It={class:"border p-2 text-right"},Bt={key:0,class:"flex-auto h-full justify-center flex items-center"},Mt={class:"py-2 w-full"},Xt={class:"font-semibold text-primary"},Kt={class:"flex-auto flex-col flex overflow-hidden"},Jt={class:"flex-auto overflow-y-auto"},Yt={class:"table ns-table w-full"},Gt={class:"text-primary"},Zt={width:"150",class:"p-2 border font-semibold"},$t={class:"p-2 border font-semibold"},eo={class:"p-2 border font-semibold"},so={key:0,class:"text-primary text-sm"},to={key:0},oo={class:"border p-2 text-center",colspan:"4"},no={width:"300",class:"border p-2"},io={class:"text-center"},ro={width:"300",class:"border p-2"},lo={class:"text-center"},co={width:"300",class:"border p-2"},uo={class:"text-center"},ao={class:"py-1 flex justify-end"},_o={class:"p-2 border-t border-box-edge flex justify-between"},po=e("div",null,null,-1);function ho(t,o,u,f,n,s){const y=m("ns-close-button"),c=m("ns-crud-form"),b=m("ns-tabs-item"),v=m("ns-button"),a=m("ns-spinner"),O=m("ns-paginate"),H=m("ns-tabs");return r(),l("div",Ze,[e("div",$e,[e("h3",es,i(s.__("Customers")),1),e("div",null,[p(y,{onClick:o[0]||(o[0]=_=>u.popup.close())})])]),e("div",ss,[p(H,{active:n.activeTab,onActive:o[7]||(o[7]=_=>n.activeTab=_)},{default:x(()=>[p(b,{identifier:"create-customers",label:s.__("New Customer")},{default:x(()=>[n.userCan("nexopos.create.customers")?(r(),L(c,{key:0,onUpdated:o[1]||(o[1]=_=>s.prefillForm(_)),onSave:o[2]||(o[2]=_=>s.handleSavedCustomer(_)),"submit-url":"/api/crud/ns.customers",src:"/api/crud/ns.customers/form-config"},{title:x(()=>[C(i(s.__("Customer Name")),1)]),save:x(()=>[C(i(s.__("Save Customer")),1)]),_:1})):d("",!0),n.userCan("nexopos.create.customers")?d("",!0):(r(),l("div",ts,[os,e("h3",is,i(s.__("Not Authorized")),1),e("p",null,i(s.__("Creating customers has been explicitly disabled from the settings.")),1)]))]),_:1},8,["label"]),p(b,{identifier:"account-payment",label:s.__("Customer Account"),class:"flex",padding:"p-0 flex"},{default:x(()=>[n.customer===null?(r(),l("div",rs,[ls,e("h3",cs,i(s.__("No Customer Selected")),1),e("p",null,i(s.__("In order to see a customer account, you need to select one customer.")),1),e("div",us,[p(v,{onClick:o[3]||(o[3]=_=>s.openCustomerSelection()),type:"info"},{default:x(()=>[C(i(s.__("Select Customer")),1)]),_:1})])])):d("",!0),n.customer?(r(),l("div",ds,[e("div",as,[e("div",_s,[e("div",ps,[e("h2",hs,i(s.__("Summary For"))+" : "+i(n.customer.first_name),1)]),e("div",fs,[e("div",ms,[e("div",bs,[e("h3",xs,i(s.__("Purchases")),1),e("div",ys,[e("h2",vs,i(s.nsCurrency(n.customer.purchases_amount)),1)])])]),e("div",gs,[e("div",ws,[e("h3",Cs,i(s.__("Owed")),1),e("div",ks,[e("h2",Ps,i(s.nsCurrency(n.customer.owed_amount)),1)])])]),e("div",Ss,[e("div",Ts,[e("h3",Vs,i(s.__("Wallet Amount")),1),e("div",js,[e("h2",Os,i(s.nsCurrency(n.customer.account_amount)),1)])])]),e("div",Ls,[e("div",As,[e("h3",Ns,i(s.__("Credit Limit")),1),e("div",Rs,[e("h2",Hs,i(s.nsCurrency(n.customer.credit_limit_amount)),1)])])])])]),e("div",Fs,[p(H,{active:n.selectedTab,onChangeTab:o[5]||(o[5]=_=>s.doChangeTab(_))},{default:x(()=>[p(b,{identifier:"orders",label:s.__("Orders")},{default:x(()=>[n.isLoadingOrders?(r(),l("div",qs,[p(a,{size:"36"})])):d("",!0),n.isLoadingOrders?d("",!0):(r(),l(g,{key:1},[e("div",Ds,[e("h2",Qs,i(s.__("Last Purchases")),1)]),e("div",Us,[e("div",Ws,[e("table",zs,[e("thead",null,[e("tr",Es,[e("th",Is,i(s.__("Order")),1),e("th",Bs,i(s.__("Options")),1)])]),e("tbody",Ms,[n.orders.length===0?(r(),l("tr",Xs,[e("td",Ks,i(s.__("No orders...")),1)])):d("",!0),(r(!0),l(g,null,k(n.orders,_=>(r(),l("tr",{key:_.id},[e("td",Js,[e("div",Ys,[e("h3",Gs,i(s.__("Code"))+": "+i(_.code),1),e("div",Zs,[e("div",$s,[e("small",null,i(s.__("Total"))+": "+i(s.nsCurrency(_.total)),1)]),e("div",et,[e("small",null,i(s.__("Status"))+": "+i(_.human_status),1)]),e("div",st,[e("small",null,i(s.__("Delivery"))+": "+i(_.human_delivery_status),1)])])])]),e("td",tt,[e("button",{onClick:E=>s.openOrderOptions(_),class:"rounded-full h-8 px-2 flex items-center justify-center border border-gray ns-inset-button success"},[nt,e("span",it,i(s.__("Options")),1)],8,ot)])]))),128))])])])])],64))]),_:1},8,["label"]),p(b,{identifier:"wallet-history",label:s.__("Wallet History")},{default:x(()=>[n.isLoadingHistory?(r(),l("div",rt,[p(a,{size:"36"})])):d("",!0),n.isLoadingHistory?d("",!0):(r(),l(g,{key:1},[e("div",lt,[e("h2",ct,i(s.__("Wallet History")),1)]),e("div",ut,[e("div",dt,[e("table",at,[e("thead",null,[e("tr",_t,[e("th",pt,i(s.__("Transaction")),1)])]),e("tbody",ht,[n.walletHistories.length===0?(r(),l("tr",ft,[e("td",mt,i(s.__("No History...")),1)])):d("",!0),(r(!0),l(g,null,k(n.walletHistories,_=>(r(),l("tr",{key:_.id},[e("td",bt,[e("div",xt,[e("h3",yt,i(s.__("Transaction"))+": "+i(s.getWalletHistoryLabel(_.operation)),1),e("div",vt,[e("div",gt,[e("small",null,i(s.__("Amount"))+": "+i(s.nsCurrency(t.amount)),1)]),e("div",wt,[e("small",null,i(s.__("Date"))+": "+i(_.created_at),1)])])])])]))),128))])])])])],64))]),_:1},8,["label"]),p(b,{identifier:"coupons",label:s.__("Coupons")},{default:x(()=>[n.isLoadingCoupons?(r(),l("div",Ct,[p(a,{size:"36"})])):d("",!0),n.isLoadingCoupons?d("",!0):(r(),l(g,{key:1},[e("div",kt,[e("h2",Pt,i(s.__("Coupons")),1)]),e("div",St,[e("div",Tt,[e("table",Vt,[e("thead",null,[e("tr",jt,[e("th",Ot,i(s.__("Name")),1),e("th",Lt,i(s.__("Type")),1),At])]),e("tbody",Nt,[n.coupons.length===0?(r(),l("tr",Rt,[e("td",Ht,i(s.__("No coupons for the selected customer...")),1)])):d("",!0),(r(!0),l(g,null,k(n.coupons,_=>(r(),l("tr",{key:_.id},[e("td",Ft,[e("h3",null,i(_.name),1),e("div",qt,[e("ul",Dt,[e("li",Qt,i(s.__("Usage :"))+" "+i(_.usage)+"/"+i(_.limit_usage),1),e("li",Ut,i(s.__("Code :"))+" "+i(_.code),1)])])]),e("td",Wt,[C(i(s.getType(_.coupon.type))+" ",1),_.coupon.type==="percentage_discount"?(r(),l("span",zt," ("+i(_.coupon.discount_value)+"%) ",1)):d("",!0),_.coupon.type==="flat_discount"?(r(),l("span",Et," ("+i(s.nsCurrency(t.value))+") ",1)):d("",!0)]),e("td",It,[p(v,{onClick:E=>s.applyCoupon(_),type:"info"},{default:x(()=>[C(i(s.__("Use Coupon")),1)]),_:2},1032,["onClick"])])]))),128))])])])])],64))]),_:1},8,["label"]),p(b,{identifier:"rewards",label:s.__("Rewards")},{default:x(()=>[n.isLoadingRewards?(r(),l("div",Bt,[p(a,{size:"36"})])):d("",!0),n.isLoadingRewards?d("",!0):(r(),l(g,{key:1},[e("div",Mt,[e("h2",Xt,i(s.__("Rewards")),1)]),e("div",Kt,[e("div",Jt,[e("table",Yt,[e("thead",null,[e("tr",Gt,[e("th",Zt,i(s.__("Name")),1),e("th",$t,i(s.__("Points")),1),e("th",eo,i(s.__("Target")),1)])]),n.rewardsResponse.data?(r(),l("tbody",so,[n.rewardsResponse.data.length===0?(r(),l("tr",to,[e("td",oo,i(s.__("No rewards available the selected customer...")),1)])):d("",!0),(r(!0),l(g,null,k(n.rewardsResponse.data,_=>(r(),l("tr",{key:_.id},[e("td",no,[e("h3",io,i(_.reward_name),1)]),e("td",ro,[e("h3",lo,i(_.points),1)]),e("td",co,[e("h3",uo,i(_.target),1)])]))),128))])):d("",!0)])])]),e("div",ao,[p(O,{pagination:n.rewardsResponse,onLoad:o[4]||(o[4]=_=>s.loadRewards(_))},null,8,["pagination"])])],64))]),_:1},8,["label"])]),_:1},8,["active"])])]),e("div",_o,[po,e("div",null,[p(v,{onClick:o[6]||(o[6]=_=>s.newTransaction(n.customer)),type:"info"},{default:x(()=>[C(i(s.__("Account Transaction")),1)]),_:1})])])])):d("",!0)]),_:1},8,["label"])]),_:1},8,["active"])])])}const F=V(Ge,[["render",ho]]),si=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"})),fo={props:["popup"],data(){return{searchCustomerValue:"",orderSubscription:null,order:{},debounceSearch:null,customers:[],isLoading:!1}},computed:{customerSelected(){return!1}},watch:{searchCustomerValue(t){clearTimeout(this.debounceSearch),this.debounceSearch=setTimeout(()=>{this.searchCustomer(t)},500)}},mounted(){this.orderSubscription=POS.order.subscribe(t=>{this.order=t}),this.getRecentCustomers(),this.$refs.searchField.focus(),this.popupCloser()},unmounted(){this.orderSubscription.unsubscribe()},methods:{__:h,popupCloser:T,nsCurrency:D,resolveIfQueued:j,attemptToChoose(){if(this.customers.length===1)return this.selectCustomer(this.customers[0]);w.info(h("Too many results.")).subscribe()},openCustomerHistory(t,o){o.stopImmediatePropagation(),this.popup.close(),P.show(F,{customer:t,activeTab:"account-payment"})},selectCustomer(t){this.customers.forEach(o=>o.selected=!1),t.selected=!0,this.isLoading=!0,POS.selectCustomer(t).then(o=>{this.isLoading=!1,this.resolveIfQueued(t)}).catch(o=>{this.isLoading=!1})},searchCustomer(t){S.post("/api/customers/search",{search:t}).subscribe(o=>{o.forEach(u=>u.selected=!1),this.customers=o})},createCustomerWithMatch(t){this.resolveIfQueued(!1),P.show(F,{name:t})},getRecentCustomers(){this.isLoading=!0,S.get("/api/customers/recently-active").subscribe({next:t=>{this.isLoading=!1,t.forEach(o=>o.selected=!1),this.customers=t},error:t=>{this.isLoading=!1}})}}},mo={id:"ns-pos-customer-select-popup",class:"ns-box shadow-xl w-4/5-screen md:w-2/5-screen xl:w-108"},bo={id:"header",class:"border-b ns-box-header text-center font-semibold text-2xl py-2"},xo={class:"relative"},yo={class:"p-2 border-b ns-box-body items-center flex justify-between"},vo={class:"flex items-center justify-between"},go=e("i",{class:"las la-eye"},null,-1),wo=[go],Co={class:"p-2 border-b ns-box-body flex justify-between text-primary"},ko={class:"input-group flex-auto border-2 rounded"},Po={class:"h-3/5-screen xl:h-2/5-screen overflow-y-auto ns-scrollbar"},So={class:"ns-vertical-menu"},To={key:0,class:"p-2 text-center text-primary"},Vo={class:"border-b border-dashed border-info-primary"},jo=["onClick"],Oo={class:"flex flex-col"},Lo={class:"text-xs text-secondary"},Ao={class:"flex items-center"},No={key:0,class:"text-error-primary"},Ro={key:1},Ho={class:"purchase-amount"},Fo=["onClick"],qo=e("i",{class:"las la-eye"},null,-1),Do=[qo],Qo={key:0,class:"z-10 top-0 absolute w-full h-full flex items-center justify-center"};function Uo(t,o,u,f,n,s){const y=m("ns-spinner");return r(),l("div",mo,[e("div",bo,[e("h2",null,i(s.__("Select Customer")),1)]),e("div",xo,[e("div",yo,[e("span",null,i(s.__("Selected"))+" : ",1),e("div",vo,[e("span",null,i(n.order.customer?`${n.order.customer.first_name} ${n.order.customer.last_name}`:"N/A"),1),n.order.customer?(r(),l("button",{key:0,onClick:o[0]||(o[0]=c=>s.openCustomerHistory(n.order.customer,c)),class:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button hover:border-transparent"},wo)):d("",!0)])]),e("div",Co,[e("div",ko,[R(e("input",{ref:"searchField",onKeydown:o[1]||(o[1]=q(c=>s.attemptToChoose(),["enter"])),"onUpdate:modelValue":o[2]||(o[2]=c=>n.searchCustomerValue=c),placeholder:"Search Customer",type:"text",class:"outline-none w-full p-2"},null,544),[[N,n.searchCustomerValue]])])]),e("div",Po,[e("ul",So,[n.customers&&n.customers.length===0?(r(),l("li",To,i(s.__("No customer match your query...")),1)):d("",!0),n.customers&&n.customers.length===0?(r(),l("li",{key:1,onClick:o[3]||(o[3]=c=>s.createCustomerWithMatch(n.searchCustomerValue)),class:"p-2 cursor-pointer text-center text-primary"},[e("span",Vo,i(s.__("Create a customer")),1)])):d("",!0),(r(!0),l(g,null,k(n.customers,c=>(r(),l("li",{onClick:b=>s.selectCustomer(c),key:c.id,class:"cursor-pointer p-2 border-b text-primary flex justify-between items-center"},[e("div",Oo,[e("span",null,i(c.first_name)+" "+i(c.last_name),1),e("small",Lo,i(c.group.name),1)]),e("p",Ao,[c.owe_amount>0?(r(),l("span",No,"-"+i(s.nsCurrency(c.owe_amount)),1)):d("",!0),c.owe_amount>0?(r(),l("span",Ro,"/")):d("",!0),e("span",Ho,i(s.nsCurrency(c.purchases_amount)),1),e("button",{onClick:b=>s.openCustomerHistory(c,b),class:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border ns-inset-button info"},Do,8,Fo)])],8,jo))),128))])]),n.isLoading?(r(),l("div",Qo,[p(y,{size:"24",border:"8"})])):d("",!0)])])}const z=V(fo,[["render",Uo]]),Wo={name:"ns-pos-manager-auth",props:["popup"],mounted(){M({login:nsHttpClient.get("/api/fields/ns.login"),csrf:nsHttpClient.get("/sanctum/csrf-cookie")}).subscribe({next:t=>{this.fields=this.validation.createFields(t.login),this.xXsrfToken=nsHttpClient.response.config.headers["X-XSRF-TOKEN"],setTimeout(()=>nsHooks.doAction("ns-login-mounted",this),100)},error:t=>{nsSnackBar.error(t.message||__("An unexpected error occurred."),__("OK"),{duration:0}).subscribe()}}),this.popupCloser()},data(){return{fields:[],validation:new W,xsrfToken:null,isSubmitting:!1,result:[]}},methods:{__,popupCloser:T,popupResolver:j,closePopup(){this.popup.close()},async login(){if(!this.validation.validateFields(this.fields))return nsSnackBar.error(__("Unable to proceed the form is not valid.")).subscribe();this.validation.disableFields(this.fields),this.isSubmitting=!0;try{const o=await new Promise((u,f)=>{nsHttpClient.post("/api/manager_auth/sign-in",this.validation.getValue(this.fields),{headers:{"X-XSRF-TOKEN":this.xsrfToken}}).subscribe({next:n=>{u(n)},error:n=>{this.isSubmitting=!1,this.validation.enableFields(this.fields),n.data&&this.validation.triggerFieldsErrors(this.fields,n.data),nsSnackBar.error(n.message).subscribe()}})});this.popupResolver(o)}catch{}}}},zo={class:"shadow-lg flex flex-col ns-box w-95vw h-50vh md:w-3/5-screen md:h-1/2-screen lg:w-2/5-screen"},Eo={class:"p-2 border-b ns-box-header items-center flex justify-between"},Io={class:"font-medium text-semibold"},Bo={class:"p-2 flex justify-end ns-box-footer"};function Mo(t,o,u,f,n,s){const y=m("ns-close-button"),c=m("ns-field"),b=m("ns-button");return r(),l("div",zo,[e("div",Eo,[e("h3",Io,i(s.__("Manager Authorization")),1),e("div",null,[p(y,{onClick:o[0]||(o[0]=v=>s.closePopup())})])]),e("div",{class:"p-2 flex-auto border-b ns-box-body overflow-y-auto",onKeyup:o[1]||(o[1]=q(v=>s.login(),["enter"]))},[(r(!0),l(g,null,k(n.fields,(v,a)=>(r(),L(c,{field:v,key:a},null,8,["field"]))),128))],32),e("div",Bo,[p(b,{onClick:o[2]||(o[2]=v=>s.login()),type:"info"},{default:x(()=>[C(i(s.__("Authenticate")),1)]),_:1})])])}const Xo=V(Wo,[["render",Mo]]),Ko={name:"ns-pos-discount-popup",props:["popup"],data(){return{finalValue:1,virtualStock:null,popupSubscription:null,mode:"",type:"",allSelected:!0,isLoading:!1,keys:[...[7,8,9].map(t=>({identifier:t,value:t})),...[4,5,6].map(t=>({identifier:t,value:t})),...[1,2,3].map(t=>({identifier:t,value:t})),{identifier:"backspace",icon:"la-backspace"},{identifier:0,value:0},{identifier:"next",icon:"la-share"}],discounts:[{identifier:"customDisc",value:20,desc:"SC"},{identifier:"customDisc",value:20,desc:"PWD"},{identifier:"customDisc",value:10,desc:"EMP"},{identifier:"customDisc",value:100,desc:"FREE"}],discountCode:"",numPax:0,numPaxDisc:0}},mounted(){this.mode=this.popup.params.reference.discount_type||"percentage",this.type=this.popup.params.type,this.mode==="percentage"?this.finalValue=this.popup.params.reference.discount_percentage||1:this.finalValue=this.popup.params.reference.discount||1,this.popupCloser()},methods:{__:h,nsCurrency:D,popupResolver:j,popupCloser:T,setPercentageType(t){this.mode=t},closePopup(){this.popup.close()},async inputValue(t){if(t.identifier==="next")try{const o=await new Promise((u,f)=>{P.show(Xo,{resolve:u,reject:f})});o.status==="success"&&(this.popup.params.onSubmit({discount_type:this.mode,discount_percentage:this.mode==="percentage"?this.finalValue:void 0,discount:this.mode==="flat"?this.finalValue:void 0,discount_manager:o.username,discount_code:this.discountCode,number_pax:this.numPax,number_pax_discount:this.numPaxDisc}),this.popup.close())}catch(o){console.log(o)}else t.identifier==="customDisc"?(this.finalValue=t.value,this.finalValue=parseFloat(this.finalValue),this.discountCode=t.desc,this.setPercentageType("percentage")):t.identifier==="backspace"?this.allSelected?(this.finalValue=0,this.allSelected=!1):(this.finalValue=this.finalValue.toString(),this.finalValue=this.finalValue.substr(0,this.finalValue.length-1)||0):this.allSelected?(this.finalValue=t.value,this.finalValue=parseFloat(this.finalValue),this.allSelected=!1):(this.finalValue+=""+t.value,this.finalValue=parseFloat(this.finalValue),this.mode==="percentage"&&(this.finalValue=this.finalValue>100?100:this.finalValue))}}},Jo={id:"numpad",class:"flex justify-between"},Yo={class:"ns-box shadow w-1/4 justify-end"},Go=["onClick"],Zo={key:0},$o={id:"discount-popup",class:"ns-box shadow min-h-2/5-screen w-6/7-screen md:w-3/5-screen lg:w-3/5-screen xl:w-2/5-screen relative"},en={class:"flex-shrink-0 flex justify-between items-center p-2 border-b ns-box-header"},sn={key:0,class:"text-xl font-bold text-primary text-center"},tn={key:1,class:"text-xl font-bold text-primary text-center"},on={id:"screen",class:"h-16 ns-box-body text-white flex items-center justify-center"},nn={class:"font-bold text-3xl"},rn={key:0},ln={key:1},cn={id:"switch-mode",class:"flex"},un=e("hr",{class:"border-r border-box-edge"},null,-1),dn={id:"numpad",class:"grid grid-flow-row grid-cols-3 grid-rows-3"},an=["onClick"],_n={key:0},pn={class:"ns-box shadow w-1/4 justify-end"},hn={class:"h-16 ns-box-body text-white flex items-center justify-center"},fn={class:"font-bold text-lg"},mn={class:"h-16 ns-box-body text-white flex items-center justify-center"},bn={class:"h-16 ns-box-body text-white flex items-center justify-center"},xn={class:"font-bold text-lg"},yn={class:"h-16 ns-box-body text-white flex items-center justify-center"};function vn(t,o,u,f,n,s){const y=m("ns-close-button");return r(),l("div",Jo,[e("div",Yo,[(r(!0),l(g,null,k(n.discounts,(c,b)=>(r(),l("div",{onClick:v=>s.inputValue(c),key:b,class:"text-primary ns-numpad-key info text-xl font-bold border h-24 flex items-center justify-left cursor-pointer pl-2"},[c.desc?(r(),l("i",Zo,i(c.desc),1)):d("",!0)],8,Go))),128))]),e("div",$o,[e("div",en,[e("div",null,[n.type==="product"?(r(),l("h1",sn,i(s.__("Product Discount")),1)):d("",!0),n.type==="cart"?(r(),l("h1",tn,i(s.__("Cart Discount")),1)):d("",!0)]),e("div",null,[p(y,{onClick:o[0]||(o[0]=c=>s.closePopup())})])]),e("div",on,[e("h1",nn,[n.mode==="flat"?(r(),l("span",rn,i(s.nsCurrency(n.finalValue)),1)):d("",!0),n.mode==="percentage"?(r(),l("span",ln,i(n.finalValue)+"%",1)):d("",!0)])]),e("div",cn,[e("button",{onClick:o[1]||(o[1]=c=>s.setPercentageType("flat")),class:A([n.mode==="flat"?"bg-tab-active":"bg-tab-inactive text-tertiary","outline-none w-1/2 py-2 flex items-center justify-center"])},i(s.__("Flat")),3),un,e("button",{onClick:o[2]||(o[2]=c=>s.setPercentageType("percentage")),class:A([n.mode==="percentage"?"bg-tab-active":"bg-tab-inactive text-tertiary","outline-none w-1/2 py-2 flex items-center justify-center"])},i(s.__("Percentage")),3)]),e("div",dn,[(r(!0),l(g,null,k(n.keys,(c,b)=>(r(),l("div",{onClick:v=>s.inputValue(c),key:b,class:"text-primary ns-numpad-key info text-xl font-bold border h-24 flex items-center justify-center cursor-pointer"},[c.value!==void 0?(r(),l("span",_n,i(c.value),1)):d("",!0),c.icon?(r(),l("i",{key:1,class:A(["las",c.icon])},null,2)):d("",!0)],8,an))),128))])]),e("div",pn,[e("div",hn,[e("h3",fn,i(s.__("Number of PAX")),1)]),e("div",mn,[R(e("input",{"onUpdate:modelValue":o[3]||(o[3]=c=>n.numPax=c),type:"number",maxlength:"5",class:"h-16 w-11/12 text-center font-bold text-3xl text-black rounded-md no-border focus:no-border focus:outline-none hover:no-border"},null,512),[[N,n.numPax]])]),e("div",bn,[e("h3",xn,i(s.__("PAX w/ Disc")),1)]),e("div",yn,[R(e("input",{"onUpdate:modelValue":o[4]||(o[4]=c=>n.numPaxDisc=c),type:"number",maxlength:"5",class:"h-16 w-11/12 text-center font-bold text-3xl text-black rounded-md no-border focus:no-border focus:outline-none hover:no-border"},null,512),[[N,n.numPaxDisc]])])])])}const ti=V(Ko,[["render",vn]]),gn={data(){return{types:[],settingsSubscription:null,urls:{}}},props:["popup"],mounted(){this.settingsSubscription=POS.settings.subscribe(t=>{this.urls=t.urls}),this.types=POS.types.getValue(),Object.values(this.types).length===1&&this.select(Object.keys(this.types)[0]),this.popupCloser()},methods:{__:h,popupCloser:T,popupResolver:j,resolveIfQueued:j,async select(t){Object.values(this.types).forEach(u=>u.selected=!1),this.types[t].selected=!0;const o=this.types[t];try{const u=await POS.triggerOrderTypeSelection(o);POS.types.next(this.types),this.resolveIfQueued(o)}catch(u){throw u}}}},wn={id:"ns-order-type",class:"h-full w-4/5-screen md:w-2/5-screen lg:w-2/5-screen xl:w-2/6-screen shadow-lg"},Cn={id:"header",class:"h-16 flex justify-center items-center"},kn={class:"font-bold"},Pn={key:0,class:"ns-box-body grid grid-flow-row grid-cols-1 grid-rows-1"},Sn={class:"h-full w-full flex items-center justify-center flex-col"},Tn=e("i",{class:"las la-frown text-7xl text-error-tertiary"},null,-1),Vn={class:"p-4 md:w-2/3"},jn={class:"text-center"},On={class:"flex justify-center mt-4 mb-2 -mx-2"},Ln={class:"px-2"},An={class:"px-2"},Nn={key:1,class:"ns-box-body grid grid-flow-row grid-cols-2 grid-rows-2"},Rn=["onClick"],Hn=["src"],Fn={class:"font-semibold text-xl my-2"};function qn(t,o,u,f,n,s){const y=m("ns-link");return r(),l("div",wn,[e("div",Cn,[e("h3",kn,i(s.__("Define The Order Type")),1)]),Object.values(n.types).length===0?(r(),l("div",Pn,[e("div",Sn,[Tn,e("div",Vn,[e("p",jn,i(s.__("No payment type has been selected on the settings. Please check your POS features and choose the supported order type")),1),e("div",On,[e("div",Ln,[p(y,{target:"_blank",type:"info",href:"https://my.nexopos.com/en/documentation/components/order-types"},{default:x(()=>[C(i(s.__("Read More")),1)]),_:1})]),e("div",An,[p(y,{target:"_blank",type:"info",href:n.urls.order_type_url},{default:x(()=>[C(i(s.__("Configure")),1)]),_:1},8,["href"])])])])])])):d("",!0),Object.values(n.types).length>0?(r(),l("div",Nn,[(r(!0),l(g,null,k(n.types,c=>(r(),l("div",{onClick:b=>s.select(c.identifier),key:c.identifier,class:A([c.selected?"active":"","ns-numpad-key info h-56 flex items-center justify-center flex-col cursor-pointer border"])},[e("img",{src:c.icon,alt:"",class:"w-32 h-32"},null,8,Hn),e("h4",Fn,i(c.label),1)],10,Rn))),128))])):d("",!0)])}const oi=V(gn,[["render",qn]]),Dn={name:"ns-pos-quantity-popup",props:["popup"],components:{nsNumpad:Y,nsNumpadPlus:G},data(){return{finalValue:1,virtualStock:null,options:{},optionsSubscription:null,allSelected:!0,isLoading:!1}},beforeDestroy(){this.optionsSubscription.unsubscribe()},mounted(){this.optionsSubscription=POS.options.subscribe(t=>{this.options=t}),this.popup.params.product.quantity&&(this.finalValue=this.popup.params.product.quantity),this.popupCloser()},unmounted(){nsHotPress.destroy("pos-quantity-numpad"),nsHotPress.destroy("pos-quantity-backspace"),nsHotPress.destroy("pos-quantity-enter")},methods:{__:h,popupCloser:T,closePopup(){this.popup.params.reject(!1),this.popup.close()},updateQuantity(t){this.finalValue=t},defineQuantity(t){const{product:o,data:u}=this.popup.params;if(t===0)return w.error(h("Please provide a quantity")).subscribe();if(o.$original().stock_management==="enabled"&&o.$original().type==="materialized"){const f=POS.getStockUsage(o.$original().id,u.unit_quantity_id)-(o.quantity||0);if(t>parseFloat(u.$quantities().quantity)-f)return w.error(h("Unable to add the product, there is not enough stock. Remaining %s").replace("%s",u.$quantities().quantity-f)).subscribe()}this.resolve({quantity:t})},resolve(t){this.popup.params.resolve(t),this.popup.close()}}},Qn={class:"ns-box shadow min-h-2/5-screen w-3/4-screen md:w-3/5-screen lg:w-2/5-screen xl:w-2/5-screen relative"},Un={key:0,id:"loading-overlay",style:{background:"rgb(202 202 202 / 49%)"},class:"flex w-full h-full absolute top-O left-0 items-center justify-center"},Wn={class:"flex-shrink-0 flex justify-between items-center p-2 border-b ns-box-header"},zn={class:"text-xl font-bold text-primary text-center"},En={id:"screen",class:"h-24 primary ns-box-body flex items-center justify-center"},In={class:"font-bold text-3xl"};function Bn(t,o,u,f,n,s){const y=m("ns-spinner"),c=m("ns-close-button"),b=m("ns-numpad"),v=m("ns-numpad-plus");return r(),l("div",Qn,[n.isLoading?(r(),l("div",Un,[p(y)])):d("",!0),e("div",Wn,[e("div",null,[e("h1",zn,i(s.__("Define Quantity")),1)]),e("div",null,[p(c,{onClick:o[0]||(o[0]=a=>s.closePopup())})])]),e("div",En,[e("h1",In,i(n.finalValue),1)]),n.options.ns_pos_numpad==="default"?(r(),L(b,{key:1,floating:n.options.ns_pos_allow_decimal_quantities,onChanged:o[1]||(o[1]=a=>s.updateQuantity(a)),onNext:o[2]||(o[2]=a=>s.defineQuantity(a)),value:n.finalValue},null,8,["floating","value"])):d("",!0),n.options.ns_pos_numpad==="advanced"?(r(),L(v,{key:2,onChanged:o[3]||(o[3]=a=>s.updateQuantity(a)),onNext:o[4]||(o[4]=a=>s.defineQuantity(a)),value:n.finalValue},null,8,["value"])):d("",!0)])}const Mn=V(Dn,[["render",Bn]]);class ni{constructor(o){Q(this,"product");this.product=o}run(o){return new Promise((u,f)=>{const n=this.product;if(POS.options.getValue().ns_pos_show_quantity!==!1||!POS.processingAddQueue)P.show(Mn,{resolve:u,reject:f,product:n,data:o});else{if(n.$original().stock_management==="enabled"&&n.$original().type==="materialized"){const c=POS.getStockUsage(n.$original().id,o.unit_quantity_id)-(n.quantity||0);if(1>parseFloat(o.$quantities().quantity)-c)return w.error(h("Unable to add the product, there is not enough stock. Remaining %s").replace("%s",(o.$quantities().quantity-c).toString())).subscribe()}u({quantity:1})}})}}export{ni as P,ti as a,oi as b,Xo as c,Ye as d,si as e,z as n};
